

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Source Code Status Report: gwexpy/gui &mdash; gwexpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            gwexpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/tutorials/index.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/en/index.html">Detailed Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/ja/index.html">詳細リファレンス</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gwexpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Source Code Status Report: gwexpy/gui</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/tatsuki-washimi/gwexpy/blob/main/docs/developers/gui/implementation_map.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="source-code-status-report-gwexpy-gui">
<h1>Source Code Status Report: gwexpy/gui<a class="headerlink" href="#source-code-status-report-gwexpy-gui" title="Link to this heading"></a></h1>
<section id="id1">
<h2>1. 全体アーキテクチャ<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>本プロジェクトは、C++製の “DTT diaggui” を Python (PyQt5 + pyqtgraph) で再現し、かつ拡張することを目的としています。</p>
<ul class="simple">
<li><p><strong>Entry Point</strong>: <code class="docutils literal notranslate"><span class="pre">pyaggui.py</span></code> (ランチャー) -&gt; <code class="docutils literal notranslate"><span class="pre">MainWindow</span></code> (Core Logic)</p></li>
<li><p><strong>Threading</strong>: NDS通信 (<code class="docutils literal notranslate"><span class="pre">NDSThread</span></code>)、チャンネル検索 (<code class="docutils literal notranslate"><span class="pre">ChannelListWorker</span></code>)、データストリーミングは非同期スレッドで実行され、GUIのフリーズを防ぐ設計になっています。</p></li>
<li><p><strong>Data Flow</strong>: <code class="docutils literal notranslate"><span class="pre">NDSThread</span></code> (Raw Data) -&gt; <code class="docutils literal notranslate"><span class="pre">MainWindow</span></code> (Orchestration) -&gt; <code class="docutils literal notranslate"><span class="pre">SpectralAccumulator</span></code> (FFT/Averaging) -&gt; <code class="docutils literal notranslate"><span class="pre">Engine</span></code> (Legacy/Calc) -&gt; <code class="docutils literal notranslate"><span class="pre">GraphPanel</span></code> (Plotting)。</p></li>
</ul>
</section>
<section id="id2">
<h2>2. 機能実装状況詳細<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<section id="a-data-sources">
<h3>A. データ取得 (Data Sources)<a class="headerlink" href="#a-data-sources" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>NDS (Network Data Server)</strong>: <code class="docutils literal notranslate"><span class="pre">gwexpy.gui.nds.nds_thread</span></code> にて <code class="docutils literal notranslate"><span class="pre">nds2-client</span></code> を用いた実装が完了しています。機能: <code class="docutils literal notranslate"><span class="pre">iterate</span></code> によるオンラインストリーミング、<code class="docutils literal notranslate"><span class="pre">find_channels</span></code> によるチャンネル検索。切断処理: <code class="docutils literal notranslate"><span class="pre">stop()</span></code> メソッドで明示的にコネクションを閉じる処理も実装済。</p></li>
<li><p><strong>File Loading</strong>: <code class="docutils literal notranslate"><span class="pre">gwexpy.gui.loaders</span></code> にて、<code class="docutils literal notranslate"><span class="pre">.xml</span></code> (DTT), <code class="docutils literal notranslate"><span class="pre">.gwf</span></code> (Frame), <code class="docutils literal notranslate"><span class="pre">.h5</span></code> などの読み込みをサポート。DTT XMLからはチャンネル設定（Active状態など）の復元も行っています。</p></li>
</ul>
</section>
<section id="b-excitation">
<h3>B. 信号生成 (Excitation)<a class="headerlink" href="#b-excitation" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">gwexpy.gui.excitation.generator.SignalGenerator</span></code> にて、シミュレーション用の波形生成ロジックが実装されています。</p>
<ul class="simple">
<li><p><strong>対応波形</strong>:</p>
<ul>
<li><p>Sine, Square, Ramp (Sawtooth), Triangle</p></li>
<li><p>Impulse (Pulse Train)</p></li>
<li><p>Noise (Gaussian/Uniform) + IIRフィルタリング (Low/High/Bandpass)</p></li>
<li><p>Sweep (Linear/Log Chirp): 周期的なスイープ信号生成も実装済。</p></li>
</ul>
</li>
<li><p><strong>注入 (Injection)</strong>: <code class="docutils literal notranslate"><span class="pre">MainWindow</span></code> 内で、計測データに対して生成した信号を加算（Inject）するロジックが存在します。</p></li>
</ul>
</section>
<section id="c-spectral-processing">
<h3>C. データ解析・加工 (Spectral Processing)<a class="headerlink" href="#c-spectral-processing" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">gwexpy.gui.streaming.SpectralAccumulator</span></code> が中核となります。</p>
<ul class="simple">
<li><p><strong>平均化</strong>: Fixed (回数指定), Infinite, Exponential (指数移動平均) をサポート。</p></li>
<li><p><strong>FFT処理</strong>: <code class="docutils literal notranslate"><span class="pre">gwpy.timeseries</span></code> の機能を利用し、PSD, CSD, Coherence, Transfer Function を計算可能。</p></li>
<li><p><strong>Spectrogram</strong>:</p>
<ul>
<li><p><strong>履歴保持</strong>: <code class="docutils literal notranslate"><span class="pre">self.spectrogram_history</span></code> (Deque) による短時間FFT結果の蓄積。</p></li>
<li><p><strong>計算</strong>: 瞬時スペクトルの算出と、時間・周波数軸を含む2Dデータ構造 (<code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">times</span></code>, <code class="docutils literal notranslate"><span class="pre">freqs</span></code>) への整形ロジックが完備されています。</p></li>
</ul>
</li>
</ul>
</section>
<section id="d-plotting">
<h3>D. グラフ描画 (Plotting)<a class="headerlink" href="#d-plotting" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">gwexpy.gui.ui.graph_panel.GraphPanel</span></code> が <code class="docutils literal notranslate"><span class="pre">pyqtgraph</span></code> をラップしています。</p>
<ul class="simple">
<li><p><strong>1D Plot</strong>: 折れ線グラフ、対数軸、凡例、カーソル（X/Y読取, Delta測定）機能実装済。</p></li>
<li><p><strong>2D Plot (Spectrogram)</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ImageItem</span></code> を使用。</p></li>
<li><p>グラフタイプ選択 (“Spectrogram”) に応じた 1D/2D 表示モードの自動切替 (<code class="docutils literal notranslate"><span class="pre">update_style</span></code> メソッド)。</p></li>
<li><p>dB / Phase / Magnitude の表示単位変換とカラーマップ適用。</p></li>
<li><p>軸範囲（Log/Linear）に応じた <code class="docutils literal notranslate"><span class="pre">ImageItem.setRect</span></code> による正しい座標マッピング。</p></li>
</ul>
</li>
<li><p><strong>UI連携</strong>: タブ切り替えによる設定変更（Trace, Range, Units, Cursor）が即座に反映される仕組みです。</p></li>
</ul>
</section>
<section id="e-ui-ux-tabs">
<h3>E. UI/UX (Tabs)<a class="headerlink" href="#e-ui-ux-tabs" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">gwexpy.gui.ui.tabs</span></code> にて DTT ライクなタブ構成が再現されています。</p>
<ul class="simple">
<li><p><strong>Measurement</strong>: 計測パラメータ（Start Freq, BW, Averages, Window等）の設定。</p></li>
<li><p><strong>Excitation</strong>: 波形生成パネルの追加・削除・設定。</p></li>
<li><p><strong>Results</strong>: グラフ表示エリア（上下2面分割構成）。</p></li>
</ul>
</section>
<section id="f-result-tab-menu-bar">
<h3>F. Result Tab / Menu Bar 機能マッピング詳細調査<a class="headerlink" href="#f-result-tab-menu-bar" title="Link to this heading"></a></h3>
<p>ご指摘の「Result Tabのボタン」について、C++ DTTのソースコード (<code class="docutils literal notranslate"><span class="pre">diagmain.cc</span></code>, <code class="docutils literal notranslate"><span class="pre">diagctrl.cc</span></code>, <code class="docutils literal notranslate"><span class="pre">TLGPad.cc</span></code>) と照合した結果、これらはResult Tab固有の埋め込みボタンではなく、主に<strong>メニューバー (Main Menu)</strong> 経由で提供される機能であることが判明しました。また、”Options” ボタンは独自の実装を持っています。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>機能名 (User Term)</p></th>
<th class="head text-left"><p>C++ DTT 実装 / Menu Path</p></th>
<th class="head text-left"><p><code class="docutils literal notranslate"><span class="pre">gwexpy</span></code> 実装状況</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Reset</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">M_PLOT_RESET</span></code> (Plot -&gt; Reset)</p></td>
<td class="text-left"><p><strong>実装済</strong>: オートレンジ実行。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Import</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">M_FILE_IMPORT</span></code> (File -&gt; Import)</p></td>
<td class="text-left"><p><strong>実装済</strong>: データ読み込み。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Export</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">M_FILE_EXPORT</span></code> (File -&gt; Export)</p></td>
<td class="text-left"><p><strong>実装済</strong>: HDF5/GWF/CSV形式での保存機能 (<code class="docutils literal notranslate"><span class="pre">export_data</span></code>) を実装済み。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Options</strong> (Layout)</p></td>
<td class="text-left"><p>Button: <code class="docutils literal notranslate"><span class="pre">kGMPadOptionID</span></code> / Menu: <code class="docutils literal notranslate"><span class="pre">M_WINDOW_LAYOUT</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: グラフ分割レイアウト (1x1, 2x1 縦/横) を選択するダイアログを実装済み。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Options</strong> (Detailed)</p></td>
<td class="text-left"><p>Icon: <code class="docutils literal notranslate"><span class="pre">kGOptDialogID</span></code> (各グラフ上のアイコン)</p></td>
<td class="text-left"><p><strong>未実装</strong>: Traces, Range, Units, Cursor 等の詳細設定ダイアログ。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>New</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">kGMPadNewID</span></code> (Button “New”) / <code class="docutils literal notranslate"><span class="pre">M_WINDOW_NEW</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: 共有データ (<code class="docutils literal notranslate"><span class="pre">PlotSet</span></code>) を参照する新しいプロット用トップレベルウィンドウを開く機能を実装済み (<code class="docutils literal notranslate"><span class="pre">ResultWindow</span></code>)。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Zoom</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">kGMPadZoomID</span></code> (Button “Zoom”) / <code class="docutils literal notranslate"><span class="pre">M_WINDOW_ZOOM_...</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: アクティブなグラフの最大化/復元トグル機能を実装済み。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Active</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">kGMPadActiveID</span></code> (Button “Active”) / <code class="docutils literal notranslate"><span class="pre">M_WINDOW_ACTIVE_...</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: 次のグラフへフォーカス移動するサイクリック機能を実装済み。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Reference</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">kGMPadReferenceID</span></code> (Button “Reference…”) / <code class="docutils literal notranslate"><span class="pre">M_PLOT_REFERENCE</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: リファレンストレース管理ダイアログを表示する機能を実装済み（データ重ね書き機能自体は別途拡張が必要）。</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Calibration</strong></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">kGMPadCalibrationID</span></code> (Button “Calibration…”) / <code class="docutils literal notranslate"><span class="pre">M_PLOT_CALIBRATION_...</span></code></p></td>
<td class="text-left"><p><strong>実装済</strong>: キャリブレーション編集ダイアログ（チャンネル設定、ZPK編集、ファイル入出力）を実装済み。</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Print</strong></p></td>
<td class="text-left"><p>Menu: <code class="docutils literal notranslate"><span class="pre">File</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Print</span></code></p></td>
<td class="text-left"><p><strong>未実装</strong>。</p></td>
</tr>
</tbody>
</table>
<p><strong>結論</strong>: DTT diagguiのResult Tabにあるボタン群（Reset, Zoom, Active, New, Options, Import, Export, Reference, Calibration）は、<strong>全ての実装が完了</strong> しました。UIの配置および挙動もDTT仕様に準拠しています。</p>
</section>
</section>
<section id="id3">
<h2>3. 今後の課題・未実装と思われる点<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>上記調査に基づく残課題は以下の通りです。</p>
<ul class="simple">
<li><p><strong>Menu Barの拡充</strong>: C++ DTTの操作感に近づける場合、ボタン配置だけでなくメニューバーへの機能統合（Action実装）も進める必要があります。</p></li>
<li><p><strong>Advanced DTT Features</strong>: Stepped Sine (Swept Sine) 測定モードの専用ロジックの確認（現状は Broadband ノイズ/スイープ注入＋FFT が主）。</p></li>
<li><p><strong>Reference / Calibration の深掘り</strong>: UIは実装されましたが、リファレンスのプロット重ね合わせ描画や、設定したキャリブレーションのリアルタイム適用ロジックはエンジンの拡張が必要です。</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, gwexpy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>