

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScalarField 可視化（1D/2D）強化ロードマップ &mdash; gwexpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            gwexpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/tutorials/index.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/en/index.html">Detailed Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/ja/index.html">詳細リファレンス</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">gwexpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ScalarField 可視化（1D/2D）強化ロードマップ</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/tatsuki-washimi/gwexpy/blob/main/docs/developers/archive/plans/visualize-methods_ScalarField.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scalarfield-1d-2d">
<h1>ScalarField 可視化（1D/2D）強化ロードマップ<a class="headerlink" href="#scalarfield-1d-2d" title="Link to this heading"></a></h1>
<section id="id1">
<h2>前提（既存仕様の尊重）<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>ScalarField は <strong>4D維持</strong>（整数indexも slice(i,i+1) に変換し axis length=1 を保つ）</p></li>
<li><p>軸 index は <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> 配列が正</p></li>
<li><p>空間FFTは符号付き両側、波数は角波数 <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">=</span> <span class="pre">2π/λ</span></code></p></li>
<li><p>時間FFTは GWpy <code class="docutils literal notranslate"><span class="pre">TimeSeries.fft()</span></code> 準拠（既実装）</p></li>
<li><p>可視化は <strong>matplotlib</strong> を使用（依存追加は避ける）</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id2">
<h2>フェーズ0（最優先）：共通インフラの追加<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<section id="id3">
<h3>0.1 座標→インデックス変換ユーティリティ（必須）<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p><strong>新規モジュール案</strong>：<code class="docutils literal notranslate"><span class="pre">gwexpy/plot/_coord.py</span></code> または <code class="docutils literal notranslate"><span class="pre">gwexpy/types/_coord.py</span></code></p>
<section id="id4">
<h4>実装する関数（新規）<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nearest_index(axis_index,</span> <span class="pre">value)</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code></p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axis_index</span></code>：<code class="docutils literal notranslate"><span class="pre">Quantity</span></code> 1D 配列</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code>：<code class="docutils literal notranslate"><span class="pre">Quantity</span></code> スカラー</p></li>
<li><p>unit 不一致は <code class="docutils literal notranslate"><span class="pre">ValueError</span></code></p></li>
<li><p>範囲外は <code class="docutils literal notranslate"><span class="pre">IndexError</span></code>（もしくは <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。どちらかに統一）</p></li>
<li><p>tie-break は「小さい側を優先」（固定）</p></li>
</ul>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">slice_from_index(i:</span> <span class="pre">int)</span> <span class="pre">-&gt;</span> <span class="pre">slice</span></code></p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">slice(i,</span> <span class="pre">i+1)</span></code> を返す</p></li>
</ul>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">slice_from_value(axis_index,</span> <span class="pre">value,</span> <span class="pre">method=&quot;nearest&quot;)</span> <span class="pre">-&gt;</span> <span class="pre">slice</span></code></p></li>
</ol>
<ul class="simple">
<li><p>MVP は <code class="docutils literal notranslate"><span class="pre">method=&quot;nearest&quot;</span></code> のみ対応でよい</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nearest_index</span></code> を呼び <code class="docutils literal notranslate"><span class="pre">slice_from_index</span></code> へ</p></li>
</ul>
</section>
</section>
<section id="phase-0-1-dod">
<h3>Phase 0.1 DoD<a class="headerlink" href="#phase-0-1-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>unit不一致、範囲外、tie-break がテストで固定される</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id5">
<h3>0.2 値の取り出し規約（複素対策・重複防止）<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p><strong>新規関数</strong>：<code class="docutils literal notranslate"><span class="pre">select_value(data,</span> <span class="pre">mode=&quot;real|imag|abs|angle|power&quot;)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code> は <code class="docutils literal notranslate"><span class="pre">abs(data)**2</span></code>（単位は unit^2 になることに注意）</p></li>
<li><p>デフォルト：<code class="docutils literal notranslate"><span class="pre">real</span></code>（または <code class="docutils literal notranslate"><span class="pre">abs</span></code>。方針を固定して実装。推奨：time-domainは real、frequency/k-domain は abs 既定でもよいが、最初は一律 real でよい）</p></li>
</ul>
</section>
<section id="phase-0-2-dod">
<h3>Phase 0.2 DoD<a class="headerlink" href="#phase-0-2-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>複素入力で mode ごとに数値が一致するテスト</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">power</span></code> の unit の扱いが破綻しない（単位付きQuantityなら unit^2）</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="api-plot">
<h3>0.3 抽出API（解析メソッド；plotの基盤）<a class="headerlink" href="#api-plot" title="Link to this heading"></a></h3>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.extract_points(...)</span> <span class="pre">-&gt;</span> <span class="pre">TimeSeriesList</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">points</span></code>: list[tuple[x,y,z]]（Quantity推奨）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interp=&quot;nearest&quot;</span></code>（MVPはnearestのみ）</p></li>
<li><p>戻り値：<code class="docutils literal notranslate"><span class="pre">TimeSeriesList</span></code>（各要素が1点抽出の時系列）</p></li>
<li><p>ラベル（metadata）に座標情報を保存（<code class="docutils literal notranslate"><span class="pre">(x=...,y=...,z=...)</span></code>）</p></li>
</ul>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.extract_profile(...)</span> <span class="pre">-&gt;</span> <span class="pre">(Quantity_axis,</span> <span class="pre">Quantity_values)</span></code> または <code class="docutils literal notranslate"><span class="pre">Series</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code>: “x|y|z”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">at</span></code>: dict で他軸を固定（例：<code class="docutils literal notranslate"><span class="pre">{&quot;t&quot;:...,</span> <span class="pre">&quot;y&quot;:...,</span> <span class="pre">&quot;z&quot;:...}</span></code>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduce</span></code>: None または簡易平均（次フェーズでも可）</p></li>
<li><p>MVPは <code class="docutils literal notranslate"><span class="pre">reduce=None</span></code>（一点断面）のみでよい</p></li>
</ul>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.slice_map2d(plane=&quot;xy|xz|yz&quot;,</span> <span class="pre">at={...})</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p>
<ul class="simple">
<li><p>planeの2軸は残し、他2軸は length=1 のスライスにする</p></li>
<li><p>返り値は ScalarField（axis length=1規約を維持）</p></li>
</ul>
</section>
<section id="phase-0-3-dod">
<h3>Phase 0.3 DoD<a class="headerlink" href="#phase-0-3-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extract_points</span></code> の返す各時系列の長さが t 軸と一致</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slice_map2d</span></code> 後に plane 以外の2軸が length=1</p></li>
<li><p>単位・メタデータが落ちない</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id6">
<h2>フェーズ1：最小描画（研究即戦力）<a class="headerlink" href="#id6" title="Link to this heading"></a></h2>
<section id="d-scalarfield-plot-map2d">
<h3>1.1 2Dヒートマップ：<code class="docutils literal notranslate"><span class="pre">ScalarField.plot_map2d(...)</span></code><a class="headerlink" href="#d-scalarfield-plot-map2d" title="Link to this heading"></a></h3>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">gwexpy/plot/scalarfield.py</span></code> を作り、実処理を集約
<code class="docutils literal notranslate"><span class="pre">ScalarField.plot_map2d</span></code> は薄いラッパ（内部で plot モジュール関数を呼ぶ）</p>
<section id="mvp">
<h4>推奨シグネチャ（MVP）<a class="headerlink" href="#mvp" title="Link to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">plot_map2d(self,</span> <span class="pre">*,</span> <span class="pre">plane=&quot;xy&quot;,</span> <span class="pre">at=None,</span> <span class="pre">mode=&quot;real&quot;,</span> <span class="pre">method=&quot;pcolormesh&quot;,</span> <span class="pre">ax=None,</span> <span class="pre">add_colorbar=True,</span> <span class="pre">vmin=None,</span> <span class="pre">vmax=None,</span> <span class="pre">title=None)</span> <span class="pre">-&gt;</span> <span class="pre">(fig,</span> <span class="pre">ax)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">at</span></code> が None の場合は、axis length=1 の軸を自動採用（曖昧なら例外）</p></li>
<li><p>pcolormesh 既定（不等間隔に強い）</p></li>
<li><p>軸ラベルに unit を付与（例：<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">[m]</span></code>）</p></li>
</ul>
</section>
</section>
<section id="phase-1-1-dod">
<h3>Phase 1.1 DoD<a class="headerlink" href="#phase-1-1-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">slice_map2d(...).plot_map2d(...)</span></code> が動作する</p></li>
<li><p>軸ラベルに unit が含まれる</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_colorbar=True</span></code> で colorbar が出る</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="d-scalarfield-plot-timeseries-points">
<h3>1.2 1D重ね書き：<code class="docutils literal notranslate"><span class="pre">ScalarField.plot_timeseries_points(...)</span></code><a class="headerlink" href="#d-scalarfield-plot-timeseries-points" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>内部は <code class="docutils literal notranslate"><span class="pre">extract_points</span></code> を呼ぶのみ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels</span></code> がなければ自動生成</p></li>
</ul>
</section>
<section id="phase-1-2-dod">
<h3>Phase 1.2 DoD<a class="headerlink" href="#phase-1-2-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>複数点で line が複数本描画される</p></li>
<li><p>ラベルが自動で入る（legendはオプションでも可）</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="d-scalarfield-plot-profile">
<h3>1.3 1D線プロファイル：<code class="docutils literal notranslate"><span class="pre">ScalarField.plot_profile(...)</span></code><a class="headerlink" href="#d-scalarfield-plot-profile" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>内部は <code class="docutils literal notranslate"><span class="pre">extract_profile</span></code> を呼ぶのみ</p></li>
</ul>
</section>
<section id="phase-1-3-dod">
<h3>Phase 1.3 DoD<a class="headerlink" href="#phase-1-3-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>指定 axis に沿った1Dプロファイルが描画される</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="roi">
<h2>フェーズ2：比較・要約（高ROI）<a class="headerlink" href="#roi" title="Link to this heading"></a></h2>
<section id="id7">
<h3>2.1 フィールド差分／比：解析メソッド<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.diff(other,</span> <span class="pre">mode=&quot;diff|ratio|percent&quot;)</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p>
<ul class="simple">
<li><p>modeの意味を固定</p></li>
<li><p>unit の扱い：</p>
<ul>
<li><p>diff：同unit</p></li>
<li><p>ratio/percent：dimensionless</p></li>
</ul>
</li>
</ul>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.zscore(baseline_t=(t1,t2),</span> <span class="pre">...)</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p>
<ul class="simple">
<li><p>baseline の抽出は axis0_domain=”time” の時のみ</p></li>
<li><p>baseline 期間の平均/標準偏差で zscore</p></li>
</ul>
<p><strong>描画</strong>：差分は <code class="docutils literal notranslate"><span class="pre">plot_map2d</span></code> に流す（<code class="docutils literal notranslate"><span class="pre">plot_map2d_diff</span></code> は不要）</p>
</section>
<section id="phase-2-1-dod">
<h3>Phase 2.1 DoD<a class="headerlink" href="#phase-2-1-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>diff/ratio の unit が正しい</p></li>
<li><p>zscore の baseline 指定が範囲外で例外</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id8">
<h3>2.2 時間要約マップ<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.time_stat_map(stat=&quot;mean|std|rms|max&quot;,</span> <span class="pre">t_range=(t1,t2),</span> <span class="pre">plane=&quot;xy&quot;,</span> <span class="pre">at={...})</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p>
<ul class="simple">
<li><p>結果は t 軸を length=1 にして返す（時間要約済み）</p></li>
<li><p>表示は <code class="docutils literal notranslate"><span class="pre">plot_map2d</span></code> に流用</p></li>
</ul>
</section>
<section id="phase-2-2-dod">
<h3>Phase 2.2 DoD<a class="headerlink" href="#phase-2-2-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>t_range 指定で正しい期間が使われる</p></li>
<li><p>statごとに期待値と一致する小テスト</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="timespace-map">
<h3>2.3 time–space map（ムービー代替）<a class="headerlink" href="#timespace-map" title="Link to this heading"></a></h3>
<p><strong>新規</strong>：<code class="docutils literal notranslate"><span class="pre">ScalarField.time_space_map(axis=&quot;x|y|z&quot;,</span> <span class="pre">at={...},</span> <span class="pre">mode=&quot;real&quot;,</span> <span class="pre">reduce=None)</span> <span class="pre">-&gt;</span> <span class="pre">Array2D相当</span> <span class="pre">or</span> <span class="pre">ScalarField</span></code></p>
<ul class="simple">
<li><p>MVP：reduce=None（一点断面）</p></li>
<li><p>出力は (t, x) の2Dデータ（最小は numpy array + (t,x)のQuantity）</p></li>
<li><p>描画は <code class="docutils literal notranslate"><span class="pre">plot_map2d</span></code> 相当関数に流せる形にする</p></li>
</ul>
</section>
<section id="phase-2-3-dod">
<h3>Phase 2.3 DoD<a class="headerlink" href="#phase-2-3-dod" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>(t, x) のshapeが期待通り</p></li>
<li><p>t/x の軸ラベルが描画で正しい</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="id9">
<h2>フェーズ3：重い信号処理（最後）<a class="headerlink" href="#id9" title="Link to this heading"></a></h2>
<section id="xcorr-delay-coherence-mapplot">
<h3>3.1 xcorr / delay / coherence（解析→map→plot）<a class="headerlink" href="#xcorr-delay-coherence-mapplot" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">compute_xcorr(point_a,</span> <span class="pre">point_b,</span> <span class="pre">max_lag,</span> <span class="pre">...)</span> <span class="pre">-&gt;</span> <span class="pre">lag-series</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_delay_map(ref_point,</span> <span class="pre">plane,</span> <span class="pre">at,</span> <span class="pre">...)</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coherence_map(ref_point,</span> <span class="pre">band=(f1,f2),</span> <span class="pre">...)</span> <span class="pre">-&gt;</span> <span class="pre">ScalarField</span></code></p></li>
<li><p>表示は <code class="docutils literal notranslate"><span class="pre">plot_map2d</span></code> に統一</p></li>
</ul>
<p><strong>注意</strong>：このフェーズは計算コストが大きいので <code class="docutils literal notranslate"><span class="pre">stride</span></code> や <code class="docutils literal notranslate"><span class="pre">roi</span></code> を必須オプションにすること。</p>
</section>
</section>
<hr class="docutils" />
<section id="pytest">
<h2>テスト計画（pytest；最低限）<a class="headerlink" href="#pytest" title="Link to this heading"></a></h2>
</section>
<section id="t0">
<h2>T0：ユーティリティ<a class="headerlink" href="#t0" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nearest_index</span></code> の unit不一致例外</p></li>
<li><p>範囲外例外</p></li>
<li><p>tie-breakの固定</p></li>
</ul>
</section>
<section id="t1">
<h2>T1：抽出<a class="headerlink" href="#t1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extract_points</span></code> が TimeSeriesList を返す（長さ一致）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slice_map2d</span></code> で2軸が残り2軸は length=1</p></li>
</ul>
</section>
<section id="t2-plot">
<h2>T2：plot（画像比較は不要）<a class="headerlink" href="#t2-plot" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plot_map2d</span></code> が <code class="docutils literal notranslate"><span class="pre">Axes</span></code> を返し、colorbarが追加される（<code class="docutils literal notranslate"><span class="pre">len(fig.axes)</span></code> 等で確認）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_timeseries_points</span></code> が line を複数生成する（<code class="docutils literal notranslate"><span class="pre">len(ax.lines)</span></code>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_profile</span></code> が line を1本以上生成</p></li>
</ul>
</section>
<section id="t3">
<h2>T3：比較<a class="headerlink" href="#t3" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>diff/ratio の unit</p></li>
<li><p>zscore の baseline範囲外例外</p></li>
</ul>
</section>
<section id="t4-time-stat-map-time-space-map">
<h2>T4：time_stat_map / time_space_map<a class="headerlink" href="#t4-time-stat-map-time-space-map" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>小さな人工データで平均などが一致</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="id10">
<h2>実装メモ（重要）<a class="headerlink" href="#id10" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>描画関数は <strong>必ず</strong> <code class="docutils literal notranslate"><span class="pre">ax</span></code> を受け、与えられなければ <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code> で作る</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> の import は plot モジュール内に閉じる（types 層に依存を持ち込まない）</p></li>
<li><p>2D描画は <code class="docutils literal notranslate"><span class="pre">pcolormesh</span></code> 既定（不等間隔軸でも正しい）</p></li>
<li><p>値の取り出し（real/abs等）は共通関数 <code class="docutils literal notranslate"><span class="pre">select_value</span></code> を必ず通す（重複排除）</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="dod">
<h2>受け入れ条件（DoDまとめ）<a class="headerlink" href="#dod" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>フェーズ1完了時点で：</p>
<ul>
<li><p>断面2Dマップが1行で描ける（<code class="docutils literal notranslate"><span class="pre">slice_map2d(...).plot_map2d()</span></code>）</p></li>
<li><p>任意点群の時系列重ね書きが1行で描ける</p></li>
<li><p>任意断面の線プロファイルが描ける</p></li>
</ul>
</li>
<li><p>フェーズ2完了で：</p>
<ul>
<li><p>diff/zscore/time要約/time–space が解析→描画に乗る</p></li>
</ul>
</li>
<li><p>テストが全て通る（画像比較なしで構造検証）</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="t12-58-jst">
<h2>実装計画レビュー (2026-01-21T12:58 JST)<a class="headerlink" href="#t12-58-jst" title="Link to this heading"></a></h2>
</section>
<section id="id11">
<h2>モデル選定<a class="headerlink" href="#id11" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>採用モデル</strong>: Claude Opus 4.5</p></li>
<li><p><strong>理由</strong>: 高精度なロジック実装と物理数学的な厳密さが求められるため、コード生成能力と推論能力のバランスに優れた Claude 系列を採用。特に複雑なスライス操作や単位計算のバグを最小限に抑える。</p></li>
</ul>
</section>
<section id="id12">
<h2>推奨スキル<a class="headerlink" href="#id12" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">extend_gwpy</span></code></strong>: <code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> の GWpy/Astropy 継承におけるスライス操作での単位消失防止ガイド</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">check_physics</span></code></strong>: 空間FFTの波数（k）や Nyquist 周波数の扱い、物理単位の整合性検証</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">test_code</span></code></strong>: T0〜T4 テストの自動実行によるリグレッション防止</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">make_notebook</span></code></strong>: 可視化機能のチュートリアルノートブック作成</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">debug_axes</span></code></strong>: 軸スケール・目盛・単位ラベル表示のデバッグ</p></li>
</ol>
</section>
<section id="id13">
<h2>工数見積もり<a class="headerlink" href="#id13" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>フェーズ</p></th>
<th class="head text-left"><p>難易度</p></th>
<th class="head text-left"><p>推定時間</p></th>
<th class="head text-left"><p>クオータ消費</p></th>
<th class="head text-left"><p>主な作業</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Phase 0: インフラ</p></td>
<td class="text-left"><p>高</p></td>
<td class="text-left"><p>90分</p></td>
<td class="text-left"><p>High</p></td>
<td class="text-left"><p>座標変換ユーティリティ、抽出APIの実装、Unitテスト</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Phase 1: 基本描画</p></td>
<td class="text-left"><p>中</p></td>
<td class="text-left"><p>60分</p></td>
<td class="text-left"><p>Medium</p></td>
<td class="text-left"><p>Map2D, 1D Profile の Matplotlib 実装</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Phase 2: 比較・要約</p></td>
<td class="text-left"><p>中〜高</p></td>
<td class="text-left"><p>60分</p></td>
<td class="text-left"><p>Medium</p></td>
<td class="text-left"><p>Diff/Ratio, Z-score, Time-Space Map の計算ロジック</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>合計</strong></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p><strong>約 3.5〜4 時間</strong></p></td>
<td class="text-left"><p><strong>High</strong></p></td>
<td class="text-left"><p>(Phase 0-2 を含む)</p></td>
</tr>
</tbody>
</table>
<section id="id14">
<h3>懸念事項<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>4D データのスライス規約（length=1 を維持）が既存の GWpy メソッドと競合しないかの検証</p></li>
<li><p>複素数データの <code class="docutils literal notranslate"><span class="pre">power</span></code> モードにおける単位（unit^2）の扱い</p></li>
<li><p>大規模データに対する Matplotlib の描画パフォーマンス</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="t13-15-jst">
<h2>実装進捗 (2026-01-21T13:15 JST)<a class="headerlink" href="#t13-15-jst" title="Link to this heading"></a></h2>
<section id="phase-0">
<h3>✅ Phase 0: 共通インフラの追加（完了）<a class="headerlink" href="#phase-0" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>項目</p></th>
<th class="head text-left"><p>ファイル</p></th>
<th class="head text-left"><p>状態</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">nearest_index</span></code>, <code class="docutils literal notranslate"><span class="pre">slice_from_index</span></code>, <code class="docutils literal notranslate"><span class="pre">slice_from_value</span></code></p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">gwexpy/plot/_coord.py</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">select_value</span></code> (real/imag/abs/angle/power)</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">gwexpy/plot/_coord.py</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>T0 テスト</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">tests/plot/test_coord.py</span></code></p></td>
<td class="text-left"><p>✅ 21テスト通過</p></td>
</tr>
</tbody>
</table>
</section>
<section id="phase-1">
<h3>✅ Phase 1: 最小描画（完了）<a class="headerlink" href="#phase-1" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>項目</p></th>
<th class="head text-left"><p>メソッド</p></th>
<th class="head text-left"><p>状態</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>抽出API</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.extract_points()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>抽出API</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.extract_profile()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>抽出API</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.slice_map2d()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>2Dヒートマップ</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.plot_map2d()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1D重ね書き</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.plot_timeseries_points()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1D線プロファイル</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.plot_profile()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>T1-T2 テスト</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">tests/fields/test_scalarfield_visualization.py</span></code></p></td>
<td class="text-left"><p>✅ 17テスト通過</p></td>
</tr>
</tbody>
</table>
</section>
<section id="phase-2">
<h3>✅ Phase 2: 比較・要約（完了）<a class="headerlink" href="#phase-2" title="Link to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>項目</p></th>
<th class="head text-left"><p>メソッド</p></th>
<th class="head text-left"><p>状態</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>差分/比率</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.diff()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Z-score</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.zscore()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>時間要約マップ</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.time_stat_map()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>時間-空間マップ</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.time_space_map()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>時間-空間描画</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">ScalarField.plot_time_space_map()</span></code></p></td>
<td class="text-left"><p>✅ 実装済み</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>T3-T4 テスト</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">tests/fields/test_scalarfield_visualization.py</span></code></p></td>
<td class="text-left"><p>✅ 11テスト通過</p></td>
</tr>
</tbody>
</table>
</section>
<section id="phase-3">
<h3>⏳ Phase 3: 重い信号処理（未着手）<a class="headerlink" href="#phase-3" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">compute_xcorr</span></code>, <code class="docutils literal notranslate"><span class="pre">time_delay_map</span></code>, <code class="docutils literal notranslate"><span class="pre">coherence_map</span></code> は今後の実装予定</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, gwexpy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>