# LIGO DTT GUI (pyaggui) 詳細ギャップ分析レポート

## 1. 概要
`gwexpy/gui/pyaggui.py` の詳細分析を行いました。外観（Look & Feel）の再現度は高いものの、機能面（Behavior）において多くの要素が「見た目だけ（Visual Only）」の状態にあることが確認されました。

## 2. 機能別ギャップ詳細

### 2.1 メインウィンドウ & ツールバー (Main Window & Toolbar)
| UI要素 | 現状 (Status) | 期待される動作 (Expected Behavior) |
| :--- | :--- | :--- |
| **メニューバー**<br>(File, Edit...) | **未実装**<br>メニュー項目が表示されるだけで、アクションは空です。 | 設定の保存/読込、データのエクスポート、ウィンドウ操作等が機能すること。 |
| **下部ツールバー**<br>(Reset, Zoom, Print...) | **未実装**<br>ループでボタンを生成しているだけで、シグナル接続（`.connect`）が一切ありません。 | ボタン押下時のアクション（グラフのリセット、ダイアログ表示など）の実装が必要。 |
| **Status Bar** | **静的表示**<br>ラベルが表示されているのみです。 | システムの状態、カーソル位置の座標、エラーメッセージ等を動的に表示すべきです。 |

### 2.2 Measurement タブ (Measurement Tab)
| UI要素 | 現状 (Status) | 課題 (Issue) |
| :--- | :--- | :--- |
| **パラメータ設定**<br>(Start/Stop/BW...) | **ポーリング方式**<br>`update_graphs` ループ時に値を読み取る仕様になっています。 | 値を変更した瞬間にバリデーション（整合性チェック）が走る、あるいは即座に反映される挙動（Event-driven）が望ましい場合があります。 |
| **チャネルバンク切替**<br>(0-15, 16-31...) | **未実装**<br>ラジオボタンを押しても表示されているチャネルリスト（0-15）が切り替わりません。 | 選択したバンクに応じて、下のグリッドの内容（ラベルやコンボボックス）を動的に書き換えるロジックが必要です。 |
| **コンボボックス**<br>(Window, Average Type) | **一部動作**<br>値は Engine に渡されていますが、`Overlap` の単位変換などが適切か要検証。 | |

### 2.3 Excitation タブ (Excitation Tab)
*   **完全な未実装状態**: 画面レイアウトは構築されていますが、入力された値を取得するロジック、変数を保持する構造体、それを使用するバックエンド処理が一切存在しません。入力してもデータはどこにも保存されません。

### 2.4 Result タブ (Result Tab)
最も実装が進んでいますが、以下の欠落があります。

| サブタブ | 現状 (Status) | 詳細 |
| :--- | :--- | :--- |
| **Units** | **未実装** (Visual Only) | 単位変換（V -> m 等）のドロップダウンはありますが、グラフ軸やデータに反映させるロジックが接続されていません。 |
| **Cursor** | **未実装** (Visual Only) | カーソルのスタイル変更や、座標値を読み取って表示する機能（Values欄）が実装されていません。 |
| **Param** | **未実装** (Visual Only) | 統計情報の表示切替などのチェックボックスがありますが、機能していません。 |
| **Range** | **部分実装** | Manual/Auto 切り替えは接続されていますが、グラフ更新ループ (`update_graphs`) との兼ね合いで、手動設定したレンジが新しいデータ描画時に維持されるか（あるいは意図せずリセットされるか）挙動確認が必要です。 |
| **Spectrogram** | **未実装** | 選択可能ですが、描画エンジンが対応していません。 |

## 3. バックエンド (Engine) との連携
*   **一方通行**: 常に `update_graphs` 内で「GUIの設定値取得 -> エンジン設定 -> 計算」というフローが走っており、エンジン側からのフィードバック（計算エラー、進捗状況、オートレンジの結果など）をGUIに反映する仕組みが弱いです。
*   **データフロー**: 現在は内部生成データのみであり、外部データを取り込むためのインターフェースが定義されていません。

## 4. 提言 (Recommendations)
1.  **優先度高**: `Spectrogram` の描画サポート（`pg.ImageItem` へのデータ流し込み）。
2.  **優先度高**: 下部ツールバーの主要ボタン（特に `Reset`, `Active` 等）の実装。
3.  **優先度中**: Excitation タブは DTT の機能を模倣する上で複雑すぎるため、まずは「使用不可」として無効化するか、単純な機能（固定波形の選択など）から実装する。
4.  **改善**: チャネルバンク切り替えロジックの実装（これがないと多チャンネル対応ができない）。
