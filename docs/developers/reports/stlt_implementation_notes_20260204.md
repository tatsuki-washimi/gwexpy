# Short-Time Laplace Transform (STLT) 実装・使用上の注意点

提供された資料（土田氏、神田氏、石野氏の発表資料）および現在の `gwexpy` コードベースに基づき、STLTの実装詳細と使用上の注意点をまとめました。

## 1. 数学的定義と実装

STLTは、通常の短時間フーリエ変換（STFT）のカーネル $e^{-j\omega t}$ を、複素数 $s = \sigma + j\omega$ に拡張したものです。
時間領域での実装としては、各ウィンドウ内の信号 $h(t)$ に対して減衰項 $e^{-\sigma t}$ を乗じてから FFT を行うことと等価です。

$$ \tilde{h}_{STLT}(t, \sigma, \omega) = \int_{-\infty}^{\infty} h(\tau) w(\tau - t) e^{-\sigma \tau} e^{-j\omega \tau} d\tau $$

現在の `gwexpy.timeseries.TimeSeries.stlt` 実装はこれに準拠しており、以下の特徴を持ちます：

- **ベクトル化**: 複数の $\sigma$ (実数部) に対して一括計算が可能。
- **数値安定性**: `time_ref='center'` オプションにより、指数関数 $e^{-\sigma t}$ の発散（Overflow）を防ぐ工夫がなされている。

## 2. 推奨パラメータと設定

### ラプラス変数 ($\sigma$)

- **物理的意味**: リングダウン信号の減衰率（$\tau$）に対応します。信号の減衰とマッチする $\sigma$ を選ぶことで、スペクトル上でピークが鋭くなります。
- **設定範囲**: 解析対象（BHの質量・スピン）から予測される減衰率周辺をスキャンします。

### ウィンドウ設定

- **サイズとオーバーラップ**: STFTと同様、時間分解能と周波数分解能のトレードオフがあります。QNM解析では、数サイクル分の長さ（例: 0.1秒程度など、対象による）が用いられます。
- **スケーリング**: `scaling='dt'` により、離散和を積分近似としてスケーリングしています。

## 3. 可視化・解析手法

### 3Dスペクトル (LaplaceGram)

- 結果は `(Time, Sigma, Frequency)` の3次元配列となります。
- **可視化**: 特定の時刻 $t$ での $(\sigma, \omega)$ 平面（S-plane）や、特定の $\sigma$ での $(t, \omega)$ スペクトログラムとして表示します。
- **極の推定**: $(\sigma, \omega)$ 平面上で振幅が最大となる点を探すことで、QNMのパラメータ（複素振動数）を推定します。

### 注意点

- **端点効果**: 指数関数窓を掛ける際、$\sigma$ が負（増幅）の場合、ウィンドウの端で値が跳ね上がることがあります。
- **計算コスト**: $\sigma$ の分解能を上げると計算量とメモリ使用量が増大するため、適切なグリッド設定が必要です。

## 4. 現状のコードとの整合性

`gwexpy` の `stlt` メソッドは、資料にある「離散ラプラス変換」の要件を満たしており、特に `exp(-sigma * t)` の計算において `time_ref` を導入している点は、資料（数値計算上の工夫）とも合致します。
