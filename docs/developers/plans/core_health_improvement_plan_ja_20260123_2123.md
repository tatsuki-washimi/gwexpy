# コアコードの品質および堅牢性向上計画書 (2026-01-23 21:23:55)

## 1. 目的と目標
`gwexpy` の非GUIコアモジュールに焦点を当て、エンジニアリング品質と堅牢性を向上させます。この作業は Gemini 3 Flash の高いクオータとスピードを活用して効率的に行います。
*   **堅牢性 (Robustness)**: 漠然とした `except Exception:` を具体的な例外捕捉、または適切なログ出力に置き換えます。
*   **完全性 (Completeness)**: 信号処理やフィッティングモジュール内に残っている軽微な `TODO` 項目を解消します。
*   **近代化 (Modernization)**: Python 3.9 以上を前提とし、不要になった古いバージョン互換コードを削除します。

## 2. 詳細ロードマップ

### フェーズ 1: 例外処理の監査と厳密化（非GUI）
*   **目標**: エラーが発生した際に、原因が特定しやすく、かつ意図しないバグを隠さないようにします。
*   **対象ファイル**:
    *   `gwexpy/fitting/core.py`
    *   `gwexpy/types/series_matrix_validation_mixin.py`
    *   `gwexpy/plot/skymap.py`
    *   `gwexpy/interop/specutils_.py`
*   **内容**: コードの文脈から想定される例外（`ImportError`, `ValueError`, `KeyError` 等）を特定し、置き換えます。不明な場合は `logging.exception()` を追加します。

### フェーズ 2: コアモジュールの TODO 解消
*   **目標**: 数学・信号処理エリアの技術負債を解消します。
*   **対象**:
    *   `gwexpy/fitting/core.py`
    *   `gwexpy/spectrogram/matrix_core.py`
*   **内容**: 実装内容が明確な TODO 項目を埋め、ドキュメントを更新します。

### フェーズ 3: Python コードの近代化
*   **目標**: コードをシンプルに保ち、最新の構文を活用可能にします。
*   **対象**: `gwexpy/types/metadata.py` 等の互換レイヤー。
*   **内容**: `sys.version_info` による分岐を削除し、Python 3.9+ の標準的な書き方に統一します。

### フェーズ 4: 検証
*   **目標**: 変更によるデグレがないことを確認します。
*   **タスク**:
    *   `ruff check .` および `mypy .` の実行。
    *   コア機能のテスト (`tests/fitting`, `tests/spectrogram`, `tests/types`) の実行。

## 3. 使用モデルとリソース最適化

### 使用モデル
*   **モデル**: `Gemini 3 Flash`
*   **選定理由**: 多くのファイルにわたる小規模な修正を高速に行うのに最適であり、クオータを有効活用できるため。

### リソース管理
*   **クオータ**: 100% 残っている Flash モデルのクオータを使用して、一気に全フェーズを完了させます。

## 4. リスクと懸念事項
*   **例外の誤特定**: 実際にどのような不具合が起きうるかを正確に読み取らないと、捕捉すべきエラーを逃す可能性があります。
*   **テストカバレッジ**: 修正箇所のテストが十分でない場合、デグレに気づかないリスクがあります。
