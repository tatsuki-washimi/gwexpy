# [Task for GPT 5.2-Codex] Phase 2: TODO/デッドコード整理

## 目的
gwexpy v0.1.0b1 のリリース準備として、ソースコード内のTODO/FIXMEタグを確認・整理し、デッドコード（未使用の関数・変数・コメントアウトされたコード）を特定・削除する。

---

## 背景

リリース前のコードクリーンアップとして、以下を実施します：

1. **TODO/FIXMEタグの整理**: 未完了タスクの確認と対応方針の決定
2. **デッドコードの削除**: 未使用のコード・変数・インポートの削除
3. **コード品質の向上**: リリース可能な状態への最終調整

---

## 実施タスク

### Task 1: TODO/FIXMEタグの確認

#### 1-1. タグの検索

以下のコマンドでTODO/FIXMEタグを検索してください：

```bash
# Python ファイル内の TODO/FIXME 検索（テスト除外）
grep -r "TODO\|FIXME\|XXX\|HACK" gwexpy/ --include="*.py" | grep -v "__pycache__"
```

#### 1-2. タグの分類

検出されたタグを以下のカテゴリに分類してください：

**カテゴリA: リリース前に対応必須**
- セキュリティ上の問題
- 重大なバグや不具合
- 未実装の重要機能

**カテゴリB: リリース後に対応（Issue化推奨）**
- 最適化の余地
- 将来的な機能追加
- リファクタリング候補

**カテゴリC: 削除可能**
- 古い実装の名残
- 既に解決済みのタスク
- 不要になったコメント

#### 1-3. 対応方針の決定

各タグについて、以下のいずれかの対応を決定してください：

1. **即座に対応**: 簡単に修正可能な場合（5分以内）
2. **コメント更新**: より明確な説明に書き換え
3. **削除**: 不要なタグの削除
4. **そのまま残す**: リリース後に対応（Issue番号を追記推奨）

---

### Task 2: デッドコードの特定

#### 2-1. 未使用インポートの検出

以下のツールで未使用インポートを検出してください：

```bash
# ruff を使用（推奨）
ruff check gwexpy/ --select F401

# または autoflake
# autoflake --check --remove-unused-variables -r gwexpy/
```

#### 2-2. 未使用変数・関数の検出

```bash
# ruff を使用
ruff check gwexpy/ --select F841  # 未使用変数

# vulture を使用（より網羅的）
# vulture gwexpy/ --min-confidence 80
```

#### 2-3. コメントアウトされたコードの検出

```bash
# Python コメント内のコード検出
grep -r "^[[:space:]]*#[[:space:]]*def\|^[[:space:]]*#[[:space:]]*class\|^[[:space:]]*#[[:space:]]*import" gwexpy/ --include="*.py" | head -20
```

---

### Task 3: デッドコードの削除

#### 3-1. 自動修正可能な項目

以下のツールで自動修正してください：

```bash
# 未使用インポートの削除
ruff check gwexpy/ --select F401 --fix

# 未使用変数の削除（慎重に）
# ruff check gwexpy/ --select F841 --fix
```

**注意:**
- 自動修正は慎重に実行してください
- 修正前にバックアップまたはgit statusで確認
- 意図的に未使用の変数（プレースホルダー等）は残す

#### 3-2. 手動削除が必要な項目

以下は手動で確認・削除してください：

**削除対象:**
- コメントアウトされたコード（git履歴に残っているため）
- 未使用のヘルパー関数（他のモジュールから参照されていない）
- 古い実装の残骸

**削除禁止:**
- 公開API（`__all__` に含まれる、ドキュメント化されている）
- テストで使用されている関数
- 将来的に使用予定の関数（明確にコメント記載）

---

### Task 4: 検証

#### 4-1. 静的解析の確認

```bash
# ruff で全体チェック
ruff check gwexpy/

# mypy で型チェック
mypy gwexpy/ --config-file pyproject.toml
```

#### 4-2. テストスイートの実行

```bash
# 全テスト実行（GUI除外）
pytest tests/ -v --ignore=tests/gui/
```

**期待される結果:**
- 2280 passed（前回と同じ）
- 0 failed
- ruff/mypy で新規エラーなし

---

## 制約事項

### 削除してはいけないもの

1. **公開API**: ドキュメント化された関数・クラス
2. **将来的に使用予定**: 明確なコメント付きのコード
3. **後方互換性**: 既存ユーザーが使用している可能性のあるコード
4. **テスト用コード**: テストで参照されている関数

### 慎重に扱うべきもの

1. **プライベート関数**: `_function` で始まるが、モジュール内で使用されている
2. **プロトコル実装**: 特定のインターフェースを満たすための関数
3. **フック・コールバック**: 外部から呼ばれる可能性のある関数

---

## 成果物

以下の情報を報告してください：

### 1. TODO/FIXMEタグの集計

```
検出数: 〇〇件

カテゴリA（対応必須）: 〇件
- [ファイル名:行番号] タグ内容 → 対応方針

カテゴリB（Issue化）: 〇件
- [ファイル名:行番号] タグ内容 → Issue化推奨

カテゴリC（削除）: 〇件
- [ファイル名:行番号] タグ内容 → 削除済み

そのまま残す: 〇件
- [ファイル名:行番号] タグ内容 → 理由
```

### 2. デッドコード削除の集計

```
未使用インポート: 〇件削除
未使用変数: 〇件削除
コメントアウトコード: 〇行削除
未使用関数: 〇件削除

削除した主なファイル:
- ファイル名1: 削除内容の概要
- ファイル名2: 削除内容の概要
```

### 3. 修正箇所の一覧

```
修正ファイル数: 〇ファイル

主な修正:
1. [ファイル名] - 修正内容
2. [ファイル名] - 修正内容
...
```

### 4. 検証結果

```
ruff check: PASS / FAIL（エラー数: 〇件）
mypy: PASS / FAIL（エラー数: 〇件）
pytest: 〇 passed / 〇 failed
```

### 5. 残存する課題

```
リリース後に対応すべき項目:
- TODO項目1: 内容と理由
- TODO項目2: 内容と理由
```

---

## 完了の定義

以下の条件をすべて満たした時点で、このタスクは完了とします：

- [ ] TODO/FIXMEタグがすべて確認され、分類されている
- [ ] カテゴリCのタグがすべて削除されている
- [ ] 未使用インポートが削除されている
- [ ] コメントアウトされたコードが削除されている（理由がある場合を除く）
- [ ] ruff check がPASS（または既存エラーのみ）
- [ ] mypy がPASS（または既存エラーのみ）
- [ ] pytest がすべてPASS（2280 passed）
- [ ] 削除内容と残存課題が報告されている

---

## タイムライン

このタスクは **Phase 2: 品質向上** の一部です。

**並行作業:**
- なし（単独実施）

**前提条件:**
- テスト網羅率向上が完了済み（✅ 完了）

**次のタスク:**
- CI設定確認（GPT 5.2）
- ドキュメントビルド（GPT 5.1-Codex-Max）

完了後、結果を Claude Sonnet 4.5 に報告してください。

---

## 参考情報

### ruff の主要なルール

```bash
# F401: 未使用インポート
# F841: 未使用変数
# F811: 重複定義
# E501: 行が長すぎる（無視可）
# W291: 末尾の空白（自動修正推奨）
```

### コメントアウトコードの判断基準

**削除すべき:**
```python
# def old_function():
#     return "deprecated"
```

**残すべき:**
```python
# TODO(v0.2.0): Implement advanced caching
# def cached_function():
#     pass
```

### 安全な削除の手順

1. git status で現在の状態を確認
2. 削除対象のコードが他のモジュールから参照されていないか確認
3. 削除を実施
4. pytest で動作確認
5. 問題があればgit restoreで復元
