# ScalarField チュートリアル - 期待される出力

このドキュメントは、ScalarField チュートリアルノートブック (`field_scalar_intro.ipynb`) から得られる期待される視覚的出力と結果を説明します。

## 実行に関する注意

ScalarField チュートリアルノートブックは現在**出力セルが埋め込まれていません**。完全な視覚的デモンストレーションを見るには：

1. **ノートブックをダウンロード** - ドキュメントページから
2. **環境をセットアップ**:
   ```bash
   pip install gwexpy matplotlib numpy astropy
   ```
3. **Jupyter でノートブックを実行**:
   ```bash
   jupyter notebook field_scalar_intro.ipynb
   ```

## 期待される可視化

### セクション 3: 時間-周波数変換

**プロット 1: FFT スペクトル**
- X軸: 周波数 (Hz)、範囲 0-50 Hz
- Y軸: 振幅 (V)
- 10 Hz（入力信号の周波数）に明確なピーク
- 赤い破線は期待されるピーク位置を示す
- ScalarField.fft_time() が時間領域から周波数領域への変換を正しく行うことを実証

**出力テキスト**:
```
ピーク周波数: 10.00 Hz (期待値: 10.0 Hz)
```

**プロット 2: 逆 FFT 再構成**
- X軸: 時間 (s)
- Y軸: 振幅 (V)
- 青実線: 元の信号
- 赤破線: 再構成された信号（元の信号と完全に重なる）
- 可逆的な往復変換を実証: 時間 → 周波数 → 時間

**出力テキスト**:
```
最大再構成誤差: ~1e-15 V
```

### セクション 4: 実空間-K空間変換

**プロット 3: 空間 FFT スペクトル**
- X軸: 波数 kx (rad/m)
- Y軸: 振幅
- ±1.57 rad/m（4m 波長に対応）に対称ピーク
- 緑の網掛け領域は期待される波数を示す
- ScalarField.fft_space() が空間次元を正しく変換することを実証

**出力テキスト**:
```
ピーク波数: ±1.57 rad/m (期待値: ±1.57 rad/m)
```

### セクション 6: 信号処理

**プロット 4: パワースペクトル密度 (PSD)**
- X軸: 周波数 (Hz)、対数スケール
- Y軸: PSD、対数スケール
- 2つの曲線:
  - ソース位置 (x=1m): 30 Hz で高い PSD
  - 遠方場 (x=4m): 30 Hz で低い PSD (1/r² 減衰)
- ScalarField.psd() メソッドによるスペクトル解析を実証

**プロット 5: 周波数-空間マッピング**
- 周波数成分が空間軸に沿ってどのように変化するかを示す2Dヒートマップ
- X軸: 空間位置 (m)
- Y軸: 周波数 (Hz)、範囲 10-100 Hz
- 色: 対数スケール PSD
- ソースからの距離とともに信号強度が減少することを示す
- ScalarField.plot_freq_space() 可視化を実証

**プロット 6: 相互相関**
- X軸: x軸に沿った空間位置 (m)
- Y軸: 時間遅延 (s)
- x=1.0m（ソース位置）を中心としたV字型パターン
- 信号伝播遅延を実証
- ScalarField.plot_cross_correlation() を使用

**プロット 7: コヒーレンスマップ**
- X軸: 空間位置 (m)
- Y軸: 30 Hz でのコヒーレンス
- ソース位置 (x=1.0m) でコヒーレンスがピーク
- 距離とともにコヒーレンスが減少
- ScalarField.plot_coherence_map() を実証

### セクション 7: 数値不変量

**出力テキスト**:
```
時間 FFT 往復最大誤差: ~1e-10
時間 FFT 不変量チェック: 合格

空間 FFT 往復最大誤差: ~1e-10
空間 FFT 不変量チェック: 合格
```

FFT 実装の数値的安定性と精度を確認。

## 可視化から得られる重要な知見

1. **FFT 精度**: すべての変換は数値的に高精度（誤差 < 1e-10）
2. **4D 構造の保持**: スライス操作は常に4次元を維持
3. **領域追跡**: メタデータは時間/周波数および実空間/k空間領域を正しく追跡
4. **信号処理**: PSD、相互相関、コヒーレンスはすべて4Dフィールドでシームレスに動作
5. **物理的解釈**: 可視化は波の伝播と空間依存性を明確に示す

## プロットの生成

すべてのプロットと出力を再生成するには：

```bash
cd docs/web/en/user_guide/tutorials

# ノートブックを実行して出力とともに保存
jupyter nbconvert --to notebook --execute \
  field_scalar_intro.ipynb \
  --output field_scalar_intro.ipynb \
  --ExecutePreprocessor.timeout=300

# 日本語版の場合
cd ../../ja/user_guide/tutorials
jupyter nbconvert --to notebook --execute \
  field_scalar_intro.ipynb \
  --output field_scalar_intro.ipynb \
  --ExecutePreprocessor.timeout=300
```

## 技術的注記

- **実行時間**: ハードウェアに依存して約30-60秒
- **メモリ使用量**: 完全なノートブック実行で約500 MB
- **依存関係**: numpy, scipy, matplotlib, astropy, gwpy, gwexpy

## 今後の改善

- [ ] 主要な特徴を説明するインラインプロット注釈を追加
- [ ] 空間場の3D表面プロットを含める
- [ ] 時間発展のアニメーション例を追加
- [ ] FieldList/FieldDict を使用した複数フィールドのバッチ処理を実証

---

**最終更新**: 2026-02-10
**状態**: プロットはローカル実行により生成が必要
**優先度**: 高（PyPI リリース前の推奨、必須ではない）
