

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TimeSeriesMatrix チュートリアル &mdash; gwexpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FrequencySeriesMatrix チュートリアル" href="matrix_frequencyseries.html" />
    <link rel="prev" title="GWExPy TimeSeries 相互運用性 (Interop) チュートリアル" href="intro_interop.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            gwexpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ガイド</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">インストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">クイックスタート</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">チュートリアル</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#i">I. 基本データ構造</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#ii">II. 多チャンネル &amp; 行列コンテナ</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">TimeSeriesMatrix チュートリアル</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#代表データを用意">代表データを用意</a></li>
<li class="toctree-l4"><a class="reference internal" href="#多様な入力パターン（コンストラクタ例）">多様な入力パターン（コンストラクタ例）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#参照・切り出し">参照・切り出し</a></li>
<li class="toctree-l4"><a class="reference internal" href="#サンプル軸編集">サンプル軸編集</a></li>
<li class="toctree-l4"><a class="reference internal" href="#時間領域処理（TimeSeries-メソッドの要素ごと適用）">時間領域処理（TimeSeries メソッドの要素ごと適用）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#欠損値処理-(Imputation)">欠損値処理 (Imputation)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#前処理:-標準化と白色化">前処理: 標準化と白色化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#成分分解-(PCA-/-ICA)">成分分解 (PCA / ICA)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#相互運用性-(Interop)-入門">相互運用性 (Interop) 入門</a></li>
<li class="toctree-l4"><a class="reference internal" href="#スペクトル解析（FFT-/-PSD-/-ASD）">スペクトル解析（FFT / PSD / ASD）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bivariate-スペクトル解析（coherence-例）">bivariate スペクトル解析（coherence 例）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#表示系:-repr-/-plot-/-step">表示系: repr / plot / step</a></li>
<li class="toctree-l4"><a class="reference internal" href="#まとめ">まとめ</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="matrix_frequencyseries.html">FrequencySeriesMatrix チュートリアル</a></li>
<li class="toctree-l3"><a class="reference internal" href="matrix_spectrogram.html">SpectrogramMatrix Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iii-field-api">III. 高次元フィールド (Field API)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iv">IV. 高度な信号処理</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#v">V. 特殊ツール</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#vi">VI. ケーススタディ (具体例)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">リファレンス</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/index.html">API リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/ja/index.html">詳細リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/en/index.html">Detailed Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">開発者ガイド (Developers Guide)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gwexpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">チュートリアル</a></li>
      <li class="breadcrumb-item active">TimeSeriesMatrix チュートリアル</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/tatsuki-washimi/gwexpy/blob/main/docs/guide/tutorials/matrix_timeseries.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="TimeSeriesMatrix-チュートリアル">
<h1>TimeSeriesMatrix チュートリアル<a class="headerlink" href="#TimeSeriesMatrix-チュートリアル" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> は <code class="docutils literal notranslate"><span class="pre">SeriesMatrix</span></code> を TimeSeries 用に拡張した 3 次元配列コンテナです（shape: Nrow × Ncol × Nsample）。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dt</span> <span class="pre">/</span> <span class="pre">t0</span> <span class="pre">/</span> <span class="pre">times</span></code> など TimeSeries 互換のエイリアス</p></li>
<li><p>要素アクセスで <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> を返す（<code class="docutils literal notranslate"><span class="pre">tsm[i,</span> <span class="pre">j]</span></code>）</p></li>
<li><p>時間領域処理（detrend/bandpass/resample …）を要素ごとに適用</p></li>
<li><p>FFT/PSD/ASD や coherence などのスペクトル解析（返り値は <code class="docutils literal notranslate"><span class="pre">FrequencySeriesMatrix</span></code>）</p></li>
<li><p>表示系 (<code class="docutils literal notranslate"><span class="pre">plot</span></code>, <code class="docutils literal notranslate"><span class="pre">step</span></code>, <code class="docutils literal notranslate"><span class="pre">repr</span></code>, <code class="docutils literal notranslate"><span class="pre">_repr_html_</span></code>) をそのまま使用</p></li>
</ul>
<p>このノートブックでは追加のユーティリティ関数は定義せず、クラスメソッドを直接呼び出して動作を確認します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
import numpy as np
from astropy import units as u

from gwexpy.timeseries import TimeSeries, TimeSeriesMatrix
</pre></div>
</div>
</div>
<section id="代表データを用意">
<h2>代表データを用意<a class="headerlink" href="#代表データを用意" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>2×2 の <code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> を作り、<code class="docutils literal notranslate"><span class="pre">dt/t0/times</span></code> やメタデータ（unit/name/channel）を確認します。</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>rng = np.random.default_rng(0)

# サンプル設定
n = 1024
dt = (1 / 256) * u.s
t0 = 0 * u.s

t = (np.arange(n) * dt).to_value(u.s)

tone10 = np.sin(2 * np.pi * 10 * t)
tone20 = np.sin(2 * np.pi * 20 * t + 0.3)

data = np.empty((2, 2, n), dtype=float)
data[0, 0] = 0.5 * tone10 + 0.05 * rng.normal(size=n)
data[0, 1] = 0.5 * tone20 + 0.05 * rng.normal(size=n)
data[1, 0] = 0.3 * tone10 + 0.3 * tone20 + 0.05 * rng.normal(size=n)
data[1, 1] = 0.2 * tone10 - 0.4 * tone20 + 0.05 * rng.normal(size=n)

units = np.full((2, 2), u.V)
names = [[&quot;ch00&quot;, &quot;ch01&quot;], [&quot;ch10&quot;, &quot;ch11&quot;]]
channels = [[&quot;X:A&quot;, &quot;X:B&quot;], [&quot;Y:A&quot;, &quot;Y:B&quot;]]

tsm = TimeSeriesMatrix(
    data,
    dt=dt,
    t0=t0,
    units=units,
    names=names,
    channels=channels,
    rows={&quot;r0&quot;: {&quot;name&quot;: &quot;row0&quot;}, &quot;r1&quot;: {&quot;name&quot;: &quot;row1&quot;}},
    cols={&quot;c0&quot;: {&quot;name&quot;: &quot;col0&quot;}, &quot;c1&quot;: {&quot;name&quot;: &quot;col1&quot;}},
    name=&quot;demo&quot;,
)

display(tsm)
tsm.plot();
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<h3>SeriesMatrix: shape=(2, 2, 1024), name='demo'</h3><ul><li><b>epoch:</b> 0.0 s</li><li><b>x0:</b> 0.0 s, <b>dx:</b> 0.00390625 s, <b>N_samples:</b> 1024</li><li><b>xunit:</b> s</li></ul><h4>Row Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>channel</th>
      <th>unit</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>r0</th>
      <td>row0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>r1</th>
      <td>row1</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table><h4>Column Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>channel</th>
      <th>unit</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c0</th>
      <td>col0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>c1</th>
      <td>col1</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table><h4>Element Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unit</th>
      <th>name</th>
      <th>channel</th>
      <th>row</th>
      <th>col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>V</td>
      <td>ch00</td>
      <td>X:A</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>V</td>
      <td>ch01</td>
      <td>X:B</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>V</td>
      <td>ch10</td>
      <td>Y:A</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>V</td>
      <td>ch11</td>
      <td>Y:B</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_3_1.png" src="../../_images/guide_tutorials_matrix_timeseries_3_1.png" />
</div>
</div>
</section>
<section id="多様な入力パターン（コンストラクタ例）">
<h2>多様な入力パターン（コンストラクタ例）<a class="headerlink" href="#多様な入力パターン（コンストラクタ例）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">dt/t0</span></code> のほか、<code class="docutils literal notranslate"><span class="pre">sample_rate</span></code> や <code class="docutils literal notranslate"><span class="pre">times</span></code>、<code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> の 2D リスト、<code class="docutils literal notranslate"><span class="pre">Quantity</span></code> 入力などを確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;=== TimeSeriesMatrix コンストラクタ例 ===&quot;)
times = tsm.times

# ケース 1: sample_rate 指定（dt の代わり）
tsm_sr = TimeSeriesMatrix(
    data,
    sample_rate=256 * u.Hz,
    t0=t0,
    units=units,
    names=names,
    channels=channels,
)
print(&quot;case1 sample_rate&quot;, &quot;dt&quot;, tsm_sr.dt, &quot;sample_rate&quot;, tsm_sr.sample_rate)

# ケース 2: times 指定（不規則サンプルにも対応）
tsm_times = TimeSeriesMatrix(data, times=times, units=units, names=names)
print(&quot;case2 times&quot;, &quot;dt&quot;, tsm_times.dt, &quot;t0&quot;, tsm_times.t0, &quot;N&quot;, tsm_times.N_samples)

# ケース 3: TimeSeries の 2D リストから構築
ts00 = TimeSeries(data[0, 0], times=times, unit=u.V, name=&quot;ch00&quot;, channel=&quot;X:A&quot;)
ts01 = TimeSeries(data[0, 1], times=times, unit=u.V, name=&quot;ch01&quot;, channel=&quot;X:B&quot;)
ts10 = TimeSeries(data[1, 0], times=times, unit=u.V, name=&quot;ch10&quot;, channel=&quot;Y:A&quot;)
ts11 = TimeSeries(data[1, 1], times=times, unit=u.V, name=&quot;ch11&quot;, channel=&quot;Y:B&quot;)
tsm_from_ts = TimeSeriesMatrix([[ts00, ts01], [ts10, ts11]])
print(&quot;case3 from TimeSeries&quot;, tsm_from_ts.shape, &quot;dt&quot;, tsm_from_ts.dt)

# ケース 4: Quantity 入力（units を自動設定）
tsm_q = TimeSeriesMatrix((data * u.mV), dt=dt, t0=t0)
print(&quot;case4 Quantity meta unit&quot;, tsm_q.meta[0, 0].unit)

# 例外: dt と sample_rate / t0 と epoch は同時指定できない
for kwargs in [
    dict(dt=dt, sample_rate=256 * u.Hz, t0=t0),
    dict(dt=dt, t0=t0, epoch=t0),
]:
    try:
        _ = TimeSeriesMatrix(data, **kwargs)
    except Exception as e:
        print(&quot;error&quot;, kwargs, &quot;-&gt;&quot;, type(e).__name__, e)
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=== TimeSeriesMatrix コンストラクタ例 ===
case1 sample_rate dt 0.00390625 s sample_rate 256.0 Hz
case2 times dt 0.00390625 s t0 0.0 s N 1024
case3 from TimeSeries (2, 2, 1024) dt 0.00390625 s
case4 Quantity meta unit mV
error {&#39;dt&#39;: &lt;Quantity 0.00390625 s&gt;, &#39;sample_rate&#39;: &lt;Quantity 256. Hz&gt;, &#39;t0&#39;: &lt;Quantity 0. s&gt;} -&gt; ValueError give only one of sample_rate or dt
error {&#39;dt&#39;: &lt;Quantity 0.00390625 s&gt;, &#39;t0&#39;: &lt;Quantity 0. s&gt;, &#39;epoch&#39;: &lt;Quantity 0. s&gt;} -&gt; ValueError give only one of epoch or t0
</pre></div></div>
</div>
</section>
<section id="参照・切り出し">
<h2>参照・切り出し<a class="headerlink" href="#参照・切り出し" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tsm[i,</span> <span class="pre">j]</span></code> は <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> を返す</p></li>
<li><p>スライスは <code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> を返す</p></li>
<li><p>row/col ラベルでもアクセスできる</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>s00 = tsm[0, 0]
print(&quot;[0,0]&quot;, &quot;type&quot;, type(s00), &quot;dt&quot;, s00.dt, &quot;t0&quot;, s00.t0, &quot;unit&quot;, s00.unit)
print(&quot;[0,0]&quot;, &quot;name&quot;, s00.name, &quot;channel&quot;, s00.channel)
s00.plot(xscale=&quot;seconds&quot;)

s01 = tsm[&quot;r0&quot;, &quot;c1&quot;]
print(&quot;[r0,c1]&quot;, &quot;name&quot;, s01.name, &quot;channel&quot;, s01.channel)

sub = tsm[:, 0]
print(&quot;tsm[:,0] -&gt;&quot;, type(sub), sub.shape)
sub.plot(subplots=True, xscale=&quot;seconds&quot;);
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0,0] type &lt;class &#39;gwexpy.timeseries.timeseries.TimeSeries&#39;&gt; dt 0.00390625 s t0 0.0 s unit V
[0,0] name ch00 channel X:A
[r0,c1] name ch01 channel X:B
tsm[:,0] -&gt; &lt;class &#39;gwexpy.timeseries.matrix.TimeSeriesMatrix&#39;&gt; (2, 1, 1024)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_7_1.png" src="../../_images/guide_tutorials_matrix_timeseries_7_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_7_2.png" src="../../_images/guide_tutorials_matrix_timeseries_7_2.png" />
</div>
</div>
</section>
<section id="サンプル軸編集">
<h2>サンプル軸編集<a class="headerlink" href="#サンプル軸編集" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">diff</span></code> / <code class="docutils literal notranslate"><span class="pre">pad</span></code> は <code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> を返す</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">crop</span></code> は現在 <code class="docutils literal notranslate"><span class="pre">SeriesMatrix</span></code> を返すので、<code class="docutils literal notranslate"><span class="pre">view(TimeSeriesMatrix)</span></code> で戻します（中身は同じ）</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cropped = tsm.crop(start=1 * u.s, end=2 * u.s).view(TimeSeriesMatrix)
print(&quot;cropped&quot;, type(cropped), cropped.shape, &quot;span&quot;, cropped.span)
cropped.plot(subplots=True, xscale=&quot;seconds&quot;)

diffed = tsm.diff(n=1)
print(&quot;diffed&quot;, diffed.shape, &quot;dt&quot;, diffed.dt)
diffed.plot(subplots=True, xscale=&quot;seconds&quot;)

padded = tsm.pad(50)
print(&quot;padded&quot;, padded.shape, &quot;t0&quot;, padded.t0)
padded.plot(subplots=True, xscale=&quot;seconds&quot;);
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
cropped &lt;class &#39;gwexpy.timeseries.matrix.TimeSeriesMatrix&#39;&gt; (2, 2, 256) span (&lt;Quantity 1. s&gt;, &lt;Quantity 2. s&gt;)
diffed (2, 2, 1023) dt 0.00390625 s
padded (2, 2, 1124) t0 -0.1953125 s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_9_1.png" src="../../_images/guide_tutorials_matrix_timeseries_9_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_9_2.png" src="../../_images/guide_tutorials_matrix_timeseries_9_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_9_3.png" src="../../_images/guide_tutorials_matrix_timeseries_9_3.png" />
</div>
</div>
</section>
<section id="時間領域処理（TimeSeries-メソッドの要素ごと適用）">
<h2>時間領域処理（TimeSeries メソッドの要素ごと適用）<a class="headerlink" href="#時間領域処理（TimeSeries-メソッドの要素ごと適用）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> のメソッド（<code class="docutils literal notranslate"><span class="pre">detrend</span></code>, <code class="docutils literal notranslate"><span class="pre">bandpass</span></code>, <code class="docutils literal notranslate"><span class="pre">resample</span></code> など）を行列要素ごとに適用します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>detr = tsm.detrend(&quot;constant&quot;)
bp = detr.bandpass(5, 40)
rs = bp.resample(128)

print(&quot;original&quot;, tsm.shape, &quot;sample_rate&quot;, tsm.sample_rate)
print(&quot;bandpass&quot;, bp.shape, &quot;sample_rate&quot;, bp.sample_rate)
print(&quot;resample&quot;, rs.shape, &quot;sample_rate&quot;, rs.sample_rate)

bp.plot(subplots=True, xscale=&quot;seconds&quot;)
rs.plot(subplots=True, xscale=&quot;seconds&quot;);
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
original (2, 2, 1024) sample_rate 256.0 Hz
bandpass (2, 2, 1024) sample_rate 256.0 Hz
resample (2, 2, 512) sample_rate 128.0 Hz
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_11_1.png" src="../../_images/guide_tutorials_matrix_timeseries_11_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_11_2.png" src="../../_images/guide_tutorials_matrix_timeseries_11_2.png" />
</div>
</div>
</section>
<section id="欠損値処理-(Imputation)">
<h2>欠損値処理 (Imputation)<a class="headerlink" href="#欠損値処理-(Imputation)" title="Link to this heading"></a></h2>
<p>Matrix内の欠損値 (NaN) を補完します。各チャンネルごとに適用されます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 欠損値を含むデータの作成 (デモ用)
tsm_miss = tsm.copy()
# 最初のチャンネルの一部をNaNにする (アクセスの仕方に注意: tsm[0,0] は time series)
tsm_miss[0, 0].value[50:60] = np.nan

print(&quot;Before impute (Has NaN):&quot;, np.isnan(tsm_miss[0,0].value).any())

# 補完 (線形補間)
tsm_imp = tsm_miss.impute(method=&quot;interpolate&quot;)
print(&quot;After impute (Has NaN):&quot;, np.isnan(tsm_imp[0,0].value).any())
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Before impute (Has NaN): False
After impute (Has NaN): False
</pre></div></div>
</div>
</section>
<section id="前処理:-標準化と白色化">
<h2>前処理: 標準化と白色化<a class="headerlink" href="#前処理:-標準化と白色化" title="Link to this heading"></a></h2>
<p>多変量解析の前処理として有用です。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 標準化 (Standardize): 平均0, 分散1にスケーリング
tsm_std = tsm.standardize(method=&quot;zscore&quot;)

# 白色化 (Whiten): チャンネル間の相関(共分散)を除去
# PCAを用いて無相関化します
tsm_white, w_model = tsm_std.whiten_channels(return_model=True)

print(&quot;Standardized shape:&quot;, tsm_std.shape)
print(&quot;Whitened shape:&quot;, tsm_white.shape)
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Standardized shape: (2, 2, 1024)
Whitened shape: (4, 1, 1024)
</pre></div></div>
</div>
</section>
<section id="成分分解-(PCA-/-ICA)">
<h2>成分分解 (PCA / ICA)<a class="headerlink" href="#成分分解-(PCA-/-ICA)" title="Link to this heading"></a></h2>
<p>効率的な次元圧縮や、信号源分離を行います。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 主成分分析 (PCA)
# 次元を圧縮 (例: 3チャンネル -&gt; 2主成分)
n_comp = min(2, tsm.shape[0])
pca_scores, pca_res = tsm_std.pca(n_components=n_comp, return_model=True)

print(&quot;PCA Scores shape:&quot;, pca_scores.shape)
print(&quot;Explained variance ratio:&quot;, pca_res.explained_variance_ratio)
pca_scores.plot()
plt.show()
plt.close()

# 独立成分分析 (ICA)
# 信号源分離 (Blind Source Separation)
ica_sources = tsm_std.ica(n_components=n_comp, random_state=42)
print(&quot;ICA Sources shape:&quot;, ica_sources.shape)
ica_sources.plot()
plt.show()
plt.close()
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PCA Scores shape: (2, 1, 1024)
Explained variance ratio: [0.57128681 0.41742564]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_17_1.png" src="../../_images/guide_tutorials_matrix_timeseries_17_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ICA Sources shape: (2, 1, 1024)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_17_3.png" src="../../_images/guide_tutorials_matrix_timeseries_17_3.png" />
</div>
</div>
</section>
<section id="相互運用性-(Interop)-入門">
<h2>相互運用性 (Interop) 入門<a class="headerlink" href="#相互運用性-(Interop)-入門" title="Link to this heading"></a></h2>
<p>PyTorchなどの外部ライブラリへデータを渡すことができます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>try:
    # PyTorch Tensorへ変換
    import torch
    _ = torch
    tensor = tsm.to_torch()
    print(&quot;Converted to PyTorch:&quot;, tensor.shape)
except ImportError:
    print(&quot;PyTorch not installed&quot;)
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted to PyTorch: torch.Size([2, 2, 1024])
</pre></div></div>
</div>
</section>
<section id="スペクトル解析（FFT-/-PSD-/-ASD）">
<h2>スペクトル解析（FFT / PSD / ASD）<a class="headerlink" href="#スペクトル解析（FFT-/-PSD-/-ASD）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">fft/psd/asd</span></code> は <code class="docutils literal notranslate"><span class="pre">FrequencySeriesMatrix</span></code> を返します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fft = tsm.fft()
print(&quot;fft&quot;, type(fft), fft.shape, &quot;df&quot;, fft.df, &quot;f0&quot;, fft.f0)

psd = tsm.psd(fftlength=1, overlap=0.5)
asd = tsm.asd(fftlength=1, overlap=0.5)
print(&quot;psd&quot;, psd.shape, &quot;unit&quot;, psd[0, 0].unit)
print(&quot;asd&quot;, asd.shape, &quot;unit&quot;, asd[0, 0].unit)

asd.plot(subplots=True)
plt.xscale(&#39;log&#39;)
plt.yscale(&#39;log&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fft &lt;class &#39;gwexpy.frequencyseries.matrix.FrequencySeriesMatrix&#39;&gt; (2, 2, 513) df 0.25 Hz f0 0.0 Hz
psd (2, 2, 129) unit V2 / Hz
asd (2, 2, 129) unit V / Hz(1/2)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_21_1.png" src="../../_images/guide_tutorials_matrix_timeseries_21_1.png" />
</div>
</div>
</section>
<section id="bivariate-スペクトル解析（coherence-例）">
<h2>bivariate スペクトル解析（coherence 例）<a class="headerlink" href="#bivariate-スペクトル解析（coherence-例）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix.coherence(other)</span></code> は要素ごとに coherence を計算し、<code class="docutils literal notranslate"><span class="pre">FrequencySeriesMatrix</span></code> を返します。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">other</span></code> に <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> を渡すと「全要素 vs 同一参照」の比較になります</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">other</span></code> に <code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> を渡す場合は shape (Nrow, Ncol) が一致している必要があります</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ref = tsm[0, 0]
coh = tsm.coherence(ref, fftlength=1, overlap=0.5)
print(&quot;coherence&quot;, type(coh), coh.shape, &quot;unit&quot;, coh[0, 0].unit)
coh.plot(subplots=True)

try:
    _ = tsm.coherence(tsm[:, :1], fftlength=1)
except Exception as e:
    print(&quot;shape mismatch -&gt;&quot;, type(e).__name__, e)
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coherence &lt;class &#39;gwexpy.frequencyseries.matrix.FrequencySeriesMatrix&#39;&gt; (2, 2, 129) unit coherence
shape mismatch -&gt; IndexError index 1 is out of bounds for axis 1 with size 1
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_23_1.png" src="../../_images/guide_tutorials_matrix_timeseries_23_1.png" />
</div>
</div>
</section>
<section id="表示系:-repr-/-plot-/-step">
<h2>表示系: repr / plot / step<a class="headerlink" href="#表示系:-repr-/-plot-/-step" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">repr</span></code>: テキスト表示</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_repr_html_</span></code>: ノートブックでは <code class="docutils literal notranslate"><span class="pre">display(tsm)</span></code> で表形式</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot</span></code> / <code class="docutils literal notranslate"><span class="pre">step</span></code>: クラスメソッドで直接描画</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&quot;repr:\n&quot;, tsm)
display(tsm)

tsm.plot(subplots=True, xscale=&quot;seconds&quot;)
tsm.step(where=&quot;post&quot;, xscale=&quot;seconds&quot;);
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
repr:
 SeriesMatrix(shape=(2, 2, 1024),  name=&#39;demo&#39;)
  epoch   : 0.0 s
  x0      : 0.0 s
  dx      : 0.00390625 s
  xunit   : s
  samples : 1024

[ Row metadata ]
     name channel unit
key
r0   row0
r1   row1

[ Column metadata ]
     name channel unit
key
c0   col0
c1   col1

[ Elements metadata ]
  unit  name channel  row  col
0    V  ch00     X:A    0    0
1    V  ch01     X:B    0    1
2    V  ch10     Y:A    1    0
3    V  ch11     Y:B    1    1
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<h3>SeriesMatrix: shape=(2, 2, 1024), name='demo'</h3><ul><li><b>epoch:</b> 0.0 s</li><li><b>x0:</b> 0.0 s, <b>dx:</b> 0.00390625 s, <b>N_samples:</b> 1024</li><li><b>xunit:</b> s</li></ul><h4>Row Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>channel</th>
      <th>unit</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>r0</th>
      <td>row0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>r1</th>
      <td>row1</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table><h4>Column Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>channel</th>
      <th>unit</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c0</th>
      <td>col0</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>c1</th>
      <td>col1</td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table><h4>Element Metadata</h4><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unit</th>
      <th>name</th>
      <th>channel</th>
      <th>row</th>
      <th>col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>V</td>
      <td>ch00</td>
      <td>X:A</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>V</td>
      <td>ch01</td>
      <td>X:B</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>V</td>
      <td>ch10</td>
      <td>Y:A</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>V</td>
      <td>ch11</td>
      <td>Y:B</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_25_2.png" src="../../_images/guide_tutorials_matrix_timeseries_25_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/guide_tutorials_matrix_timeseries_25_3.png" src="../../_images/guide_tutorials_matrix_timeseries_25_3.png" />
</div>
</div>
</section>
<section id="まとめ">
<h2>まとめ<a class="headerlink" href="#まとめ" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TimeSeriesMatrix</span></code> は TimeSeries 互換の軸情報（<code class="docutils literal notranslate"><span class="pre">dt/t0/times</span></code>）と要素メタデータを保ったまま、行列として一括処理できる。</p></li>
<li><p>時間領域処理（detrend/bandpass/resample 等）やスペクトル解析（asd/psd/coherence 等）を、要素ごとにまとめて適用できる。</p></li>
<li><p>まず <code class="docutils literal notranslate"><span class="pre">tsm[i,</span> <span class="pre">j]</span></code> で <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> を取り出して挙動を確認し、慣れたら行列のまま処理するのが簡単。</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro_interop.html" class="btn btn-neutral float-left" title="GWExPy TimeSeries 相互運用性 (Interop) チュートリアル" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="matrix_frequencyseries.html" class="btn btn-neutral float-right" title="FrequencySeriesMatrix チュートリアル" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, gwexpy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>