

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScalarField クラス入門 &mdash; gwexpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="gwexpy.fitting: iminuit ベースのフィッティング機能" href="advanced_fitting.html" />
    <link rel="prev" title="SpectrogramMatrix Tutorial" href="matrix_spectrogram.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            gwexpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ガイド</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">インストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">クイックスタート</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">チュートリアル</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#i">I. 基本データ構造</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ii">II. 多チャンネル &amp; 行列コンテナ</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#iii-field-api">III. 高次元フィールド (Field API)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">ScalarField クラス入門</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ScalarField-とは？">ScalarField とは？</a></li>
<li class="toctree-l4"><a class="reference internal" href="#セットアップ">セットアップ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1.-ScalarField-の初期化とメタデータ">1. ScalarField の初期化とメタデータ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-4D構造を保持するスライシング">2. 4D構造を保持するスライシング</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-時間-周波数変換（軸0のFFT）">3. 時間-周波数変換（軸0のFFT）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-実空間-K空間変換（空間軸のFFT）">4. 実空間-K空間変換（空間軸のFFT）</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5.-FieldList-と-FieldDict-によるバッチ操作">5. FieldList と FieldDict によるバッチ操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6.-信号処理と解析">6. 信号処理と解析</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6.-数値的不変量の検証">6. 数値的不変量の検証</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iv">IV. 高度な信号処理</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#v">V. 特殊ツール</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#vi">VI. ケーススタディ (具体例)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">リファレンス</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api/index.html">API リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/ja/index.html">詳細リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/en/index.html">Detailed Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">開発者ガイド (Developers Guide)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gwexpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">チュートリアル</a></li>
      <li class="breadcrumb-item active">ScalarField クラス入門</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/tatsuki-washimi/gwexpy/blob/main/docs/guide/tutorials/field_scalar_intro.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ScalarField-クラス入門">
<h1>ScalarField クラス入門<a class="headerlink" href="#ScalarField-クラス入門" title="Link to this heading"></a></h1>
<p>このノートブックでは、<code class="docutils literal notranslate"><span class="pre">gwexpy</span></code> の <code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> クラスの基本的な使い方を学びます。</p>
<section id="ScalarField-とは？">
<h2>ScalarField とは？<a class="headerlink" href="#ScalarField-とは？" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> は、時間と3次元空間の4次元データを扱うための特殊なクラスです。物理場の時空間構造を表現し、以下の機能を提供します：</p>
<ul class="simple">
<li><p><strong>軸0（時間軸）</strong>: 時間ドメイン ↔ 周波数ドメインの変換</p></li>
<li><p><strong>軸1-3（空間軸）</strong>: 実空間 ↔ K空間（波数空間）の変換</p></li>
<li><p><strong>4D構造の保持</strong>: スライシングしても常に4次元を維持</p></li>
<li><p><strong>バッチ操作</strong>: <code class="docutils literal notranslate"><span class="pre">FieldList</span></code> と <code class="docutils literal notranslate"><span class="pre">FieldDict</span></code> による複数フィールドの一括処理</p></li>
<li><p><strong>信号処理</strong>: PSD計算、周波数-空間マッピング、相互相関、コヒーレンスマップ</p></li>
</ul>
</section>
<section id="セットアップ">
<h2>セットアップ<a class="headerlink" href="#セットアップ" title="Link to this heading"></a></h2>
<p>必要なライブラリをインポートします。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
import numpy as np
from astropy import units as u

from gwexpy.fields import FieldDict, FieldList, ScalarField

# 再現性のためのシード設定
np.random.seed(42)
</pre></div>
</div>
</div>
</section>
<section id="1.-ScalarField-の初期化とメタデータ">
<h2>1. ScalarField の初期化とメタデータ<a class="headerlink" href="#1.-ScalarField-の初期化とメタデータ" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> オブジェクトを作成し、そのメタデータを確認します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 4Dデータの作成（10時点 × 8×8×8 の空間グリッド）
nt, nx, ny, nz = 10, 8, 8, 8
data = np.random.randn(nt, nx, ny, nz)

# 軸座標の定義
t = np.arange(nt) * 0.1 * u.s
x = np.arange(nx) * 0.5 * u.m
y = np.arange(ny) * 0.5 * u.m
z = np.arange(nz) * 0.5 * u.m

# ScalarField オブジェクトの作成
field = ScalarField(
    data,
    unit=u.V,
    axis0=t,
    axis1=x,
    axis2=y,
    axis3=z,
    axis_names=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;],
    axis0_domain=&quot;time&quot;,
    space_domain=&quot;real&quot;,
)

print(f&quot;Shape: {field.shape}&quot;)
print(f&quot;Unit: {field.unit}&quot;)
print(f&quot;Axis names: {field.axis_names}&quot;)
print(f&quot;Axis0 domain: {field.axis0_domain}&quot;)
print(f&quot;Space domains: {field.space_domains}&quot;)
</pre></div>
</div>
</div>
<section id="メタデータの確認">
<h3>メタデータの確認<a class="headerlink" href="#メタデータの確認" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axis0_domain</span></code>: 軸0のドメイン（”time” または “frequency”）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">space_domains</span></code>: 各空間軸のドメイン（”real” または “k”）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis_names</span></code>: 各軸の名前</p></li>
</ul>
<p>これらのメタデータは、FFT変換時に自動的に更新されます。</p>
</section>
</section>
<section id="2.-4D構造を保持するスライシング">
<h2>2. 4D構造を保持するスライシング<a class="headerlink" href="#2.-4D構造を保持するスライシング" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> の重要な特徴は、<strong>スライシングしても常に4次元を維持する</strong>ことです。 整数インデックスを使っても、自動的に長さ1のスライスに変換されます。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 整数インデックスでスライス（通常のndarrayなら3Dになる）
sliced = field[0, :, :, :]

print(f&quot;Original shape: {field.shape}&quot;)
print(f&quot;Sliced shape: {sliced.shape}&quot;)  # (1, 8, 8, 8) - 4Dを維持！
print(f&quot;Type: {type(sliced)}&quot;)  # ScalarField のまま
print(f&quot;Axis names preserved: {sliced.axis_names}&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 複数の軸で整数インデックスを使用
sliced_multi = field[0, 1, 2, 3]

print(f&quot;Multi-sliced shape: {sliced_multi.shape}&quot;)  # (1, 1, 1, 1) - やはり4D
print(f&quot;Value: {sliced_multi.value}&quot;)
</pre></div>
</div>
</div>
<p>この挙動により、ScalarFieldオブジェクトの一貫性が保たれ、メタデータ（軸名やドメイン情報）が失われることがありません。</p>
</section>
<section id="3.-時間-周波数変換（軸0のFFT）">
<h2>3. 時間-周波数変換（軸0のFFT）<a class="headerlink" href="#3.-時間-周波数変換（軸0のFFT）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">fft_time()</span></code> と <code class="docutils literal notranslate"><span class="pre">ifft_time()</span></code> メソッドを使って、時間軸を周波数軸に変換できます。 GWpy の <code class="docutils literal notranslate"><span class="pre">TimeSeries.fft()</span></code> と同じ正規化を採用しています。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 時間ドメインのScalarFieldを作成（正弦波）
t_dense = np.arange(128) * 0.01 * u.s
x_small = np.arange(4) * 1.0 * u.m
signal_freq = 10.0  # Hz

# 10 Hz の正弦波を空間的に均一に配置
data_signal = np.sin(2 * np.pi * signal_freq * t_dense.value)[:, None, None, None]
data_signal = np.tile(data_signal, (1, 4, 4, 4))

field_time = ScalarField(
    data_signal,
    unit=u.V,
    axis0=t_dense,
    axis1=x_small,
    axis2=x_small.copy(),
    axis3=x_small.copy(),
    axis_names=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;],
    axis0_domain=&quot;time&quot;,
    space_domain=&quot;real&quot;,
)

# FFT実行
field_freq = field_time.fft_time()

print(f&quot;Time domain shape: {field_time.shape}&quot;)
print(f&quot;Frequency domain shape: {field_freq.shape}&quot;)
print(f&quot;Axis0 domain changed: {field_time.axis0_domain} → {field_freq.axis0_domain}&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 周波数スペクトルをプロット（1点のx,y,zを選択）
# Note: スライスしても4D構造が維持されるため、squeeze()で次元を削減
spectrum = np.abs(field_freq[:, 0, 0, 0].value).squeeze()
freqs = field_freq._axis0_index.value

plt.figure(figsize=(10, 4))
plt.plot(freqs, spectrum, &quot;b-&quot;, linewidth=2)
plt.axvline(
    signal_freq, color=&quot;r&quot;, linestyle=&quot;--&quot;, label=f&quot;{signal_freq} Hz (Input signal)&quot;
)
plt.xlabel(&quot;Frequency [Hz]&quot;)
plt.ylabel(&quot;Amplitude [V]&quot;)
plt.title(&quot;FFT Spectrum (ScalarField)&quot;)
plt.xlim(0, 50)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ピーク周波数を確認
peak_idx = np.argmax(spectrum)
peak_freq = freqs[peak_idx]
print(f&quot;Peak frequency: {peak_freq:.2f} Hz (expected: {signal_freq} Hz)&quot;)
</pre></div>
</div>
</div>
<section id="逆FFT（周波数-→-時間）">
<h3>逆FFT（周波数 → 時間）<a class="headerlink" href="#逆FFT（周波数-→-時間）" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ifft_time()</span></code> で元の時間ドメインに戻すことができます。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 逆FFT
field_reconstructed = field_freq.ifft_time()

# 元の信号と比較
# Note: 4D構造を維持するため、squeeze()で1次元に
original = field_time[:, 0, 0, 0].value.squeeze()
reconstructed = field_reconstructed[:, 0, 0, 0].value.squeeze()

plt.figure(figsize=(10, 4))
plt.plot(t_dense.value, original, &quot;b-&quot;, label=&quot;Original&quot;, alpha=0.7)
plt.plot(t_dense.value, reconstructed.real, &quot;r--&quot;, label=&quot;Reconstructed&quot;, alpha=0.7)
plt.xlabel(&quot;Time [s]&quot;)
plt.ylabel(&quot;Amplitude [V]&quot;)
plt.title(&quot;IFFT: Frequency → Time&quot;)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# 誤差を確認
error = np.abs(original - reconstructed.real)
print(f&quot;Max reconstruction error: {np.max(error):.2e} V&quot;)
</pre></div>
</div>
</div>
</section>
</section>
<section id="4.-実空間-K空間変換（空間軸のFFT）">
<h2>4. 実空間-K空間変換（空間軸のFFT）<a class="headerlink" href="#4.-実空間-K空間変換（空間軸のFFT）" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">fft_space()</span></code> と <code class="docutils literal notranslate"><span class="pre">ifft_space()</span></code> を使って、空間軸を波数空間（K空間）に変換できます。 角波数 k = 2π / λ の符号付きFFTを使用します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 空間的に周期構造を持つデータを作成
nx, ny, nz = 16, 16, 16
x_grid = np.arange(nx) * 0.5 * u.m
y_grid = np.arange(ny) * 0.5 * u.m
z_grid = np.arange(nz) * 0.5 * u.m

# X方向に波長 4m の正弦波
wavelength = 4.0  # m
k_expected = 2 * np.pi / wavelength  # rad/m

data_spatial = np.sin(2 * np.pi * x_grid.value / wavelength)[None, :, None, None]
data_spatial = np.tile(data_spatial, (4, 1, ny, nz))

field_real = ScalarField(
    data_spatial,
    unit=u.V,
    axis0=np.arange(4) * 0.1 * u.s,
    axis1=x_grid,
    axis2=y_grid,
    axis3=z_grid,
    axis_names=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;],
    axis0_domain=&quot;time&quot;,
    space_domain=&quot;real&quot;,
)

# X軸のみFFT
field_kx = field_real.fft_space(axes=[&quot;x&quot;])

print(f&quot;Original space domains: {field_real.space_domains}&quot;)
print(f&quot;After fft_space: {field_kx.space_domains}&quot;)
print(f&quot;Axis names: {field_kx.axis_names}&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># K空間スペクトルをプロット
# Note: squeeze()で次元削減
kx_spectrum = np.abs(field_kx[0, :, 0, 0].value).squeeze()
kx_values = field_kx._axis1_index.value

plt.figure(figsize=(10, 4))
plt.plot(kx_values, kx_spectrum, &quot;b-&quot;, linewidth=2)
plt.axvline(k_expected, color=&quot;r&quot;, linestyle=&quot;--&quot;, label=f&quot;k = {k_expected:.2f} rad/m&quot;)
plt.axvline(-k_expected, color=&quot;r&quot;, linestyle=&quot;--&quot;)
plt.xlabel(&quot;Wavenumber kx [rad/m]&quot;)
plt.ylabel(&quot;Amplitude&quot;)
plt.title(&quot;Spatial FFT: Real → K space&quot;)
plt.legend()
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ピーク波数を確認
peak_idx = np.argmax(kx_spectrum)
peak_k = kx_values[peak_idx]
print(f&quot;Peak wavenumber: {peak_k:.2f} rad/m (expected: ±{k_expected:.2f} rad/m)&quot;)
</pre></div>
</div>
</div>
<section id="波長の計算">
<h3>波長の計算<a class="headerlink" href="#波長の計算" title="Link to this heading"></a></h3>
<p>K空間では、<code class="docutils literal notranslate"><span class="pre">wavelength()</span></code> メソッドで波長を計算できます。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 波長を計算
wavelengths = field_kx.wavelength(&quot;kx&quot;)

print(f&quot;Wavelength at k={k_expected:.2f}: {2 * np.pi / k_expected:.2f} m&quot;)
print(
    f&quot;Calculated wavelengths range: {wavelengths.value[wavelengths.value &gt; 0].min():.2f} - {wavelengths.value[wavelengths.value &lt; np.inf].max():.2f} m&quot;
)
</pre></div>
</div>
</div>
</section>
<section id="全空間軸のFFT">
<h3>全空間軸のFFT<a class="headerlink" href="#全空間軸のFFT" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">axes</span></code> パラメータを省略すると、全空間軸をまとめてFFTできます。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 全空間軸をFFT
field_k_all = field_real.fft_space()
print(f&quot;All spatial axes in K space: {field_k_all.space_domains}&quot;)

# 逆FFTで元に戻す
field_real_back = field_k_all.ifft_space()
print(f&quot;Back to real space: {field_real_back.space_domains}&quot;)

# 再構成誤差
reconstruction_error = np.max(np.abs(field_real.value - field_real_back.value))
print(f&quot;Max reconstruction error: {reconstruction_error:.2e}&quot;)
</pre></div>
</div>
</div>
</section>
</section>
<section id="5.-FieldList-と-FieldDict-によるバッチ操作">
<h2>5. FieldList と FieldDict によるバッチ操作<a class="headerlink" href="#5.-FieldList-と-FieldDict-によるバッチ操作" title="Link to this heading"></a></h2>
<p>複数の <code class="docutils literal notranslate"><span class="pre">ScalarField</span></code> オブジェクトをまとめて処理するには、<code class="docutils literal notranslate"><span class="pre">FieldList</span></code> または <code class="docutils literal notranslate"><span class="pre">FieldDict</span></code> を使用します。</p>
<section id="FieldList">
<h3>FieldList<a class="headerlink" href="#FieldList" title="Link to this heading"></a></h3>
<p>リスト形式で複数のフィールドを管理し、一括でFFT操作を適用できます。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 3つの異なる振幅を持つScalarFieldを作成
amplitudes = [1.0, 2.0, 3.0]
fields = []

for amp in amplitudes:
    data_temp = amp * np.random.randn(8, 4, 4, 4)
    field_temp = ScalarField(
        data_temp,
        unit=u.V,
        axis0=np.arange(8) * 0.1 * u.s,
        axis1=np.arange(4) * 0.5 * u.m,
        axis2=np.arange(4) * 0.5 * u.m,
        axis3=np.arange(4) * 0.5 * u.m,
        axis_names=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;],
        axis0_domain=&quot;time&quot;,
        space_domain=&quot;real&quot;,
    )
    fields.append(field_temp)

# FieldList を作成
field_list = FieldList(fields, validate=True)
print(f&quot;Number of fields: {len(field_list)}&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 一括で時間FFTを実行
field_list_freq = field_list.fft_time_all()

print(&quot;All fields transformed to frequency domain:&quot;)
for i, field in enumerate(field_list_freq):
    print(f&quot;  Field {i}: axis0_domain = {field.axis0_domain}&quot;)
</pre></div>
</div>
</div>
</section>
<section id="FieldDict">
<h3>FieldDict<a class="headerlink" href="#FieldDict" title="Link to this heading"></a></h3>
<p>辞書形式で名前付きフィールドを管理します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 名前付きフィールドの辞書を作成
field_dict = FieldDict(
    {&quot;channel_A&quot;: fields[0], &quot;channel_B&quot;: fields[1], &quot;channel_C&quot;: fields[2]},
    validate=True,
)

print(f&quot;Field names: {list(field_dict.keys())}&quot;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 一括で空間FFTを実行
field_dict_k = field_dict.fft_space_all(axes=[&quot;x&quot;, &quot;y&quot;])

for name, field in field_dict_k.items():
    print(f&quot;{name}: {field.space_domains}&quot;)
</pre></div>
</div>
</div>
</section>
</section>
<section id="6.-信号処理と解析">
<h2>6. 信号処理と解析<a class="headerlink" href="#6.-信号処理と解析" title="Link to this heading"></a></h2>
<p>物理場の解析において重要な信号処理手法として、以下を実演します：</p>
<ol class="arabic simple">
<li><p><strong>PSD計算</strong>: 時間・空間方向のパワースペクトル密度</p></li>
<li><p><strong>周波数-空間マッピング</strong>: 空間的に周波数がどう変化するか可視化</p></li>
<li><p><strong>相互相関</strong>: 信号の伝搬遅延の推定</p></li>
<li><p><strong>コヒーレンスマップ</strong>: 空間的なコヒーレンスの可視化</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># シミュレーションデータの生成
# 信号: 30 Hz の正弦波が x=1m から伝搬
# ノイズ: ガウスノイズ
fs = 256 * u.Hz
duration = 4 * u.s
t = np.arange(int((fs * duration).to_value(u.dimensionless_unscaled))) / fs.value
x = np.linspace(0, 5, 20)  # 5m, 20点
y = np.linspace(0, 2, 5)   # 2m, 5点
z = np.array([0])          # z=0

shape = (len(t), len(x), len(y), len(z))
data_sig = np.random.normal(0, 0.1, size=shape)

source_freq = 30.0
source_signal = np.sin(2 * np.pi * source_freq * t)
v_prop = 10.0  # 10 m/s
source_pos = 1.0

for i, xi in enumerate(x):
    dist = abs(xi - source_pos)
    delay = dist / v_prop
    shift = int(delay * fs.value)
    sig_delayed = np.roll(source_signal, shift)
    amp = 1.0 / (1.0 + dist)
    data_sig[:, i, :, 0] += amp * sig_delayed[:, np.newaxis]

field_sig = ScalarField(
    data_sig,
    unit=u.V,
    axis0=t * u.s,
    axis1=x * u.m,
    axis2=y * u.m,
    axis3=z * u.m,
    name=&quot;Environmental Field&quot;,
)
print(field_sig)
</pre></div>
</div>
</div>
<section id="パワースペクトル密度-(PSD)">
<h3>パワースペクトル密度 (PSD)<a class="headerlink" href="#パワースペクトル密度-(PSD)" title="Link to this heading"></a></h3>
<p>特定の位置でのPSDを計算し、周波数成分を確認します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># ソース位置(x=1m)と遠方(x=4m)でのPSDを比較
psd_source = field_sig.psd(point_or_region=(1.0 * u.m, 0.0 * u.m, 0.0 * u.m))
psd_far = field_sig.psd(point_or_region=(4.0 * u.m, 0.0 * u.m, 0.0 * u.m))

plt.figure(figsize=(10, 6))
psd_source.plot(label=&quot;Source (x=1m)&quot;)
psd_far.plot(label=&quot;Far (x=4m)&quot;)
plt.xscale(&quot;log&quot;)
plt.yscale(&quot;log&quot;)
plt.title(&quot;PSD at Different Locations&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
</section>
<section id="周波数-空間マッピング">
<h3>周波数-空間マッピング<a class="headerlink" href="#周波数-空間マッピング" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">plot_freq_space</span></code> を使用して、空間軸に沿った周波数スペクトルの変化を可視化します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>field_sig.plot_freq_space(
    space_axis=&quot;x&quot;,
    fixed_coords={&quot;y&quot;: 0.0 * u.m, &quot;z&quot;: 0.0 * u.m},
    freq_range=(10, 100),
    log_scale=True,
)
</pre></div>
</div>
</div>
</section>
<section id="相互相関と遅延推定">
<h3>相互相関と遅延推定<a class="headerlink" href="#相互相関と遅延推定" title="Link to this heading"></a></h3>
<p>基準点（ソース位置）と他の位置との相互相関を計算し、信号の伝搬遅延を可視化します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># x=1.0m (ソース) を基準点とする
ref_point = (1.0 * u.m, 0.0 * u.m, 0.0 * u.m)

# 相互相関の計算とプロット
lags, corrs = field_sig.plot_cross_correlation(
    ref_point=ref_point,
    scan_axis=&quot;x&quot;,
    fixed_coords={&quot;y&quot;: 0.0 * u.m, &quot;z&quot;: 0.0 * u.m},
    max_lag=0.5,
)
</pre></div>
</div>
</div>
<p>傾きがV字型になっていることから、信号が x=1.0m から両側に伝搬していることがわかります。</p>
</section>
<section id="コヒーレンスマップ">
<h3>コヒーレンスマップ<a class="headerlink" href="#コヒーレンスマップ" title="Link to this heading"></a></h3>
<p>特定周波数（ここでは30Hz）における空間的なコヒーレンスを表示します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>field_sig.plot_coherence_map(
    target_freq=30.0,
    ref_point=ref_point,
    scan_axis=&quot;x&quot;,
    fixed_coords={&quot;y&quot;: 0.0 * u.m, &quot;z&quot;: 0.0 * u.m},
)
</pre></div>
</div>
</div>
</section>
</section>
<section id="6.-数値的不変量の検証">
<h2>6. 数値的不変量の検証<a class="headerlink" href="#6.-数値的不変量の検証" title="Link to this heading"></a></h2>
<p>FFT変換の正確性を検証するため、往復変換（round-trip）が元のデータを再構成できることを確認します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 時間FFTの不変量チェック: ifft_time(fft_time(f)) ≈ f
np.random.seed(42)
data_test = np.random.randn(64, 4, 4, 4)
field_test = ScalarField(
    data_test,
    unit=u.V,
    axis0=np.arange(64) * 0.01 * u.s,
    axis1=np.arange(4) * u.m,
    axis2=np.arange(4) * u.m,
    axis3=np.arange(4) * u.m,
    axis_names=[&quot;t&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;],
    axis0_domain=&quot;time&quot;,
    space_domain=&quot;real&quot;,
)

# Round-trip
field_roundtrip = field_test.fft_time().ifft_time()

# Check
max_error_time = np.max(np.abs(field_test.value - field_roundtrip.value.real))
print(f&quot;時間FFT Round-trip max error: {max_error_time:.2e}&quot;)
assert max_error_time &lt; 1e-10, &quot;Time FFT round-trip failed!&quot;
print(&quot;✅ 時間FFT不変量チェック: PASSED&quot;)
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="matrix_spectrogram.html" class="btn btn-neutral float-left" title="SpectrogramMatrix Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="advanced_fitting.html" class="btn btn-neutral float-right" title="gwexpy.fitting: iminuit ベースのフィッティング機能" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, gwexpy contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>