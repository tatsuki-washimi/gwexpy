# 修正計画書

**日付:** 2026-01-07
**関連ドキュメント:** code_review_20260107.md

---

## 概要

本計画書は、コードレビューで発見された問題に対する修正手順を定義します。

---

## 修正フェーズ

### Phase 1: 致命的問題の修正 (高優先度)

#### 1.1 テストファイルのインポートエラー修正

**対象:** `tests/utils/test_enum.py`

**修正内容:**

- 存在しない `test_numpy_type_enum` のインポートを削除
- `TestNumpyTypeEnum` のみをインポート

---

### Phase 2: 未使用インポートの削除 (中優先度)

#### 2.1 ruff --fix による自動修正

大部分の未使用インポートは `ruff check --fix` で自動削除可能。

**対象ファイル:**

- `frequencyseries/frequencyseries.py`
- `frequencyseries/matrix_core.py`
- `spectrogram/matrix.py`
- `spectrogram/spectrogram.py`
- `timeseries/matrix.py`
- `timeseries/matrix_core.py`
- `timeseries/matrix_interop.py`
- `types/metadata.py`
- `types/series_matrix_analysis.py`
- `types/series_matrix_core.py`
- `types/series_matrix_indexing.py`
- `types/series_matrix_io.py`
- `types/seriesmatrix_base.py`

#### 2.2 plot/plot.py の手動確認

`kwargs_orig` と `units_consistent` の変数は意図的に残されている可能性があるため、確認後に削除または活用。

---

### Phase 3: 重複関数の整理 (中優先度)

#### 3.1 interop モジュールの整理

**選択肢:**

1. `interop/pandas_.py` から重複関数を削除 (推奨)
2. または `interop/frequency.py` を `interop/pandas_.py` に統合

**推奨アプローチ:**

- `interop/pandas_.py` から `to_pandas_frequencyseries` と `from_pandas_frequencyseries` を削除
- `interop/frequency.py` の実装を正式版として維持

---

### Phase 4: 空白行ホワイトスペースの修正 (低優先度)

**コマンド:**

```bash
ruff check gwexpy/ --exclude gui/ --fix
```

---

## 実行順序

1. テストファイル修正 (Phase 1.1)
2. ruff --fix による自動修正 (Phase 2.1 + Phase 4)
3. plot/plot.py の手動確認・修正 (Phase 2.2)
4. 重複関数の削除 (Phase 3.1)
5. 全体テスト実行
6. ドキュメント更新

---

## 検証計画

1. `ruff check gwexpy/ --exclude gui/` でエラー0を確認
2. `pytest tests/` で主要テストがパスすることを確認
3. 既存ノートブックの動作確認

---

## 見積もり時間

- Phase 1: 5分
- Phase 2: 10分
- Phase 3: 5分
- Phase 4: 自動 (1分)
- 検証: 10分

**合計:** 約30分
