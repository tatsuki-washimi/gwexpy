# LIGO DTT diaggui 模倣 GUI (pyaggui.py) 進捗・ギャップ分析レポート

## 1. 概要
本レポートは、LIGO DTT (Diagnostic Test Tool) の `diaggui` を模倣するPython製GUIアプリケーション (`gwexpy/gwexpy/gui/pyaggui.py`) の現状の完成度を分析したものです。ユーザーの要望に基づき、外観（Look & Feel）だけでなく機能（Functionality）の再現性に焦点を当てています。

## 2. 実装済み機能 (Progress)
これまでの開発で、以下の主要機能が実装されました。

### 2.1 外観とレイアウト
*   **メインウィンドウ**: メニューバー、タブ構造 (Input, Measurement, Excitation, Result)、下部ツールバー、ステータスバーの配置が完了しています。
*   **Result タブ**: 左右分割レイアウト（左: コントロールパネル、右: グラフエリア×2）が再現されています。左パネル内の2段タブ構成（Style, X/Y-axis, Traces, Range, Units, Cursorなど）も `QStackedWidget` を用いて視覚的に再現されています。
*   **Excitation タブ**: 外観は実装されましたが、複雑すぎるため現在は**無効化 (Disabled)** されています。

### 2.2 グラフ描画とデータ処理
*   **Engine**: `gwpy` をバックエンドに使用し、Time Series, ASD, CSD, Coherence, Transfer Function の計算ロジックが実装されています。
*   **Spectrogram**: `pg.ImageItem` を使用したスペクトログラム（時間-周波数マップ）の描画がサポートされました。周波数軸のクロッピングや、描画範囲（Rect）の適切な設定も実装済みです。
*   **単位変換 (Units)**: Resultタブの "Units" 内の "Display Y" コンボボックスにより、データの表示形式を **Magnitude (絶対値)**, **Phase (位相)**, **dB (デシベル)** に切り替える機能が、グラフ更新ループ内で動的に適用されています。

### 2.3 インタラクティブ機能
*   **リセット機能**: 下部ツールバーの "Reset" ボタンにより、グラフのズーム状態を初期化（Auto Range）できます。
*   **一括表示切替**: 下部ツールバーの "Active" ボタンにより、全トレースの表示/非表示を一括で切り替えられます。
*   **チャンネルバンク**: Measurementタブにおいて、チャンネルバンク（0-15, 16-31...）のラジオボタン操作に連動して、チャンネル選択グリッドのラベル番号が動的に更新されるようになりました。

## 3. 残存するギャップ (Gaps)

### 3.1 Result タブの未実装/不完全機能
*   **Cursor 機能**: "Cursor" タブの機能（カーソルマーカーの追加、値の読み取り・表示、デルタ測定など）はUIのみでロジックが未実装です。
*   **Range 設定の安定性**: "Range" タブで手動レンジ設定を行った際、グラフ更新時に設定が維持されるかどうかの厳密な検証が必要です（コード上は対処済みだが動作確認推奨）。
*   **Export/Import**: ツールバーにある "Export...", "Import..." ボタンは未実装です。設定やデータの保存機能がありません。

### 3.2 Measurement タブの機能不足
*   **パラメータの即時反映**: 一部のパラメータ（Window関数変更など）が、グラフ更新のタイミングによっては即座に反映されない可能性があります（基本的にはポーリング方式で取得しているため動作するはずですが、検証が必要です）。
*   **詳細設定**: "Settling Time", "Ramp Up/Down" などのExcitation関連パラメータはUIのみで、Engineには渡されていません（Excitationタブ無効化に伴い優先度は低）。

### 3.3 データソース (Input タブ)
*   **NDS2 接続**: 現在のデータは `Engine` 内で生成されるダミーデータ（正弦波、ノイズ等）です。実際のNDS2サーバーからのデータ取得機能はUIのみで未実装です。

## 4. 推奨される次のアクション
1.  **Cursor 機能の実装**: 具体的で計測可能な機能であり、解析ツールとしての価値を大きく高めます。 `pyqtgraph.InfiniteLine` を使用して実装可能です。
2.  **ファイル I/O (Export/Import)**: XML形式 (`.xml`) での計測設定の保存・読み込み機能の実装を推奨します。これはDTTの標準的な運用フローです。
3.  **NDS2 連携のプロトタイプ**: `nds2-client` (もし利用可能なら) を用いて、実際のデータを取得する試験を行うべきです。

## 5. 結論
外観の再現はほぼ完了しており、主要な描画機能（スペクトログラム、単位変換含む）も動作しています。現在は「見た目だけのダミーアプリ」から「実用的な解析ツールのプロトタイプ」へと移行した段階です。残る大きな課題は**実際のデータ接続**と**カーソル等の解析補助機能**です。
